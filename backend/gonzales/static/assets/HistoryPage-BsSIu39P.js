import{a as u,j as e}from"./query-CSQiZfg4.js";import{c as D,T as C,X as E,h as w,d as T,i as A,j as S,k as L,S as z}from"./index-C7Ryg-9g.js";import{G as F}from"./GlassCard-D-K6o67A.js";import{D as U}from"./DateRangeFilter-BxWcdgih.js";import{f as _}from"./format-Cx2mhIEl.js";import{A as P,a as R}from"./arrow-up-CjGfWy-Y.js";import"./vendor-7Rr5RJ8N.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],I=D("arrow-up-down",$);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],N=D("trash-2",K);function H({isOpen:x,onClose:l,onConfirm:o,isPending:n,totalCount:a}){const[t,d]=u.useState(""),m="DELETE",r=u.useRef(null),y=u.useRef(null);if(u.useEffect(()=>{if(!x)return;y.current=document.activeElement;const c=s=>{if(s.key==="Escape"){l();return}if(s.key==="Tab"&&r.current){const j=r.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),g=j[0],p=j[j.length-1];s.shiftKey&&document.activeElement===g?(s.preventDefault(),p==null||p.focus()):!s.shiftKey&&document.activeElement===p&&(s.preventDefault(),g==null||g.focus())}};return document.addEventListener("keydown",c),()=>{var s;document.removeEventListener("keydown",c),(s=y.current)==null||s.focus()}},[x,l]),!x)return null;const h=t.toUpperCase()===m,v=()=>{h&&(o(),d(""))},f=()=>{d(""),l()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)"},onClick:f,role:"presentation",children:e.jsxs("div",{ref:r,className:"w-full max-w-md rounded-xl p-6 shadow-xl",style:{background:"var(--g-glass)",border:"1px solid var(--g-border)"},onClick:c=>c.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{background:"var(--g-red)20"},children:e.jsx(C,{className:"w-5 h-5",style:{color:"var(--g-red)"}})}),e.jsx("h3",{id:"delete-modal-title",className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:"Delete All Measurements"})]}),e.jsx("button",{onClick:f,className:"p-1 rounded-lg transition-colors",style:{color:"var(--g-text-secondary)"},onMouseEnter:c=>c.currentTarget.style.background="var(--g-border)",onMouseLeave:c=>c.currentTarget.style.background="transparent","aria-label":"Close dialog",children:e.jsx(E,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{id:"delete-modal-description",style:{color:"var(--g-text-secondary)"},children:["You are about to permanently delete ",e.jsx("strong",{style:{color:"var(--g-text)"},children:a})," measurements. This action cannot be undone."]}),e.jsx("div",{className:"p-3 rounded-lg",style:{background:"var(--g-red)08",border:"1px solid var(--g-red)30"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--g-red)"},children:"All historical data, statistics, and trends will be lost permanently."})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-2",style:{color:"var(--g-text-secondary)"},children:["Type ",e.jsx("strong",{style:{color:"var(--g-text)"},children:m})," to confirm:"]}),e.jsx("input",{type:"text",value:t,onChange:c=>d(c.target.value),placeholder:m,className:"w-full px-3 py-2 rounded-lg text-sm",style:{background:"var(--g-input-bg)",border:"1px solid var(--g-border)",color:"var(--g-text)"},autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(w,{onClick:f,className:"flex-1",children:"Cancel"}),e.jsxs(w,{onClick:v,disabled:!h||n,className:"flex-1",style:{background:h?"var(--g-red)":void 0,color:h?"white":void 0,opacity:h?1:.5},children:[e.jsx(N,{className:"w-4 h-4"}),n?"Deleting...":"Delete All"]})]})]})]})})}function b({label:x,field:l,sortBy:o,sortOrder:n,onSort:a,align:t="right"}){const d=o===l,m=r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),a==null||a(l))};return e.jsx("th",{className:`py-3 px-3 font-medium cursor-pointer select-none transition-colors ${t==="left"?"text-left":"text-right"}`,style:{color:"var(--g-text-secondary)",fontSize:"var(--g-text-xs)"},onClick:()=>a==null?void 0:a(l),onKeyDown:m,tabIndex:0,role:"columnheader","aria-sort":d?n==="asc"?"ascending":"descending":"none",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[x,d?n==="asc"?e.jsx(P,{className:"w-3 h-3","aria-hidden":"true"}):e.jsx(R,{className:"w-3 h-3","aria-hidden":"true"}):e.jsx(I,{className:"w-3 h-3 opacity-40","aria-hidden":"true"})]})})}function V({measurements:x,onDelete:l,sortBy:o,sortOrder:n,onSort:a}){return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"glass-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(b,{label:"Time",field:"timestamp",sortBy:o,sortOrder:n,onSort:a,align:"left"}),e.jsx(b,{label:"Download",field:"download_mbps",sortBy:o,sortOrder:n,onSort:a}),e.jsx(b,{label:"Upload",field:"upload_mbps",sortBy:o,sortOrder:n,onSort:a}),e.jsx(b,{label:"Ping",field:"ping_latency_ms",sortBy:o,sortOrder:n,onSort:a}),e.jsx(b,{label:"Jitter",field:"ping_jitter_ms",sortBy:o,sortOrder:n,onSort:a}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",style:{color:"var(--g-text-secondary)",fontSize:"var(--g-text-xs)"},children:"Server"}),e.jsx("th",{className:"text-center py-3 px-3 font-medium",style:{color:"var(--g-text-secondary)",fontSize:"var(--g-text-xs)"},title:"Threshold violations: DL = Download below minimum, UL = Upload below minimum",children:"Issues"}),e.jsx("th",{className:"py-3 px-3"})]})}),e.jsx("tbody",{children:x.map((t,d)=>{const m=t.below_download_threshold||t.below_upload_threshold;return e.jsxs("tr",{className:"g-animate-in",style:{animationDelay:`${Math.min(d*30,300)}ms`,background:m?"rgba(255, 59, 48, 0.05)":void 0},children:[e.jsx("td",{className:"py-2.5 px-3",style:{color:"var(--g-text)"},children:_(t.timestamp)}),e.jsx("td",{className:"py-2.5 px-3 text-right font-medium tabular-nums",style:{color:"var(--g-blue)"},children:t.download_mbps.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 text-right font-medium tabular-nums",style:{color:"var(--g-green)"},children:t.upload_mbps.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 text-right tabular-nums",style:{color:"var(--g-text)"},children:t.ping_latency_ms.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 text-right tabular-nums",style:{color:"var(--g-text)"},children:t.ping_jitter_ms.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 max-w-[150px] truncate",style:{color:"var(--g-text-secondary)"},children:t.server_name}),e.jsx("td",{className:"py-2.5 px-3 text-center",children:m&&e.jsxs("span",{className:"text-xs font-medium cursor-help",style:{color:"var(--g-red)"},title:`${t.below_download_threshold?"Download below threshold":""}${t.below_download_threshold&&t.below_upload_threshold?", ":""}${t.below_upload_threshold?"Upload below threshold":""}`,children:[t.below_download_threshold&&"DL",t.below_download_threshold&&t.below_upload_threshold&&" / ",t.below_upload_threshold&&"UL"]})}),e.jsx("td",{className:"py-2.5 px-3",children:l&&e.jsx("button",{onClick:()=>l(t.id),className:"glass-focus-ring rounded transition-colors",style:{color:"var(--g-text-secondary)"},title:"Delete measurement","aria-label":`Delete measurement from ${_(t.timestamp)}`,onMouseEnter:r=>r.currentTarget.style.color="var(--g-red)",onMouseLeave:r=>r.currentTarget.style.color="var(--g-text-secondary)",children:e.jsx(N,{className:"w-4 h-4","aria-hidden":"true"})})})]},t.id)})})]})})}function Q(){const[x,l]=u.useState(1),[o,n]=u.useState(""),[a,t]=u.useState(""),[d,m]=u.useState("timestamp"),[r,y]=u.useState("desc"),[h,v]=u.useState(!1),f=i=>{i===d?y(M=>M==="asc"?"desc":"asc"):(m(i),y("desc")),l(1)},c={page:x,page_size:25,start_date:o?new Date(o).toISOString():void 0,end_date:a?new Date(a).toISOString():void 0,sort_by:d,sort_order:r},{data:s,isLoading:j}=T(c),g=A(),p=S(),k=()=>{p.mutate(void 0,{onSuccess:()=>{v(!1),l(1)}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between g-animate-in",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(L,{className:"w-5 h-5"}),"History"]}),e.jsx(U,{startDate:o,endDate:a,onStartDateChange:i=>{n(i),l(1)},onEndDateChange:i=>{t(i),l(1)}})]}),e.jsx(F,{padding:"none",className:"g-animate-in g-stagger-1",children:e.jsx("div",{className:"p-5",children:j?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(z,{size:32})}):s&&s.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx(V,{measurements:s.items,onDelete:i=>g.mutate(i),sortBy:d,sortOrder:r,onSort:f}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",style:{borderColor:"var(--g-border)"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:[s.total," measurements total"]}),e.jsxs(w,{size:"sm",onClick:()=>v(!0),style:{color:"var(--g-red)"},children:[e.jsx(N,{className:"w-3 h-3"}),"Delete All"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{size:"sm",onClick:()=>l(i=>Math.max(1,i-1)),disabled:x<=1,children:"Previous"}),e.jsxs("span",{className:"text-xs px-2 py-1",style:{color:"var(--g-text-secondary)"},children:["Page ",s.page," of ",s.pages]}),e.jsx(w,{size:"sm",onClick:()=>l(i=>Math.min(s.pages,i+1)),disabled:x>=s.pages,children:"Next"})]})]})]}):e.jsx("p",{className:"text-center py-12",style:{color:"var(--g-text-secondary)"},children:"No measurements found."})})}),e.jsx(H,{isOpen:h,onClose:()=>v(!1),onConfirm:k,isPending:p.isPending,totalCount:(s==null?void 0:s.total)??0})]})}export{Q as HistoryPage};
