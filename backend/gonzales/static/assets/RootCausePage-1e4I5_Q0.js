import{j as e,a as p}from"./query-CSQiZfg4.js";import{G as i}from"./GlassCard-D-K6o67A.js";import{u as d,T as v,Z as j,A as x,I as f,C as b,n as N,a1 as C,a0 as _,k,S as g}from"./index-Cc5-1RId.js";import{S as m}from"./server-Dr4lLdfu.js";import{H as w}from"./house-DhEN4A--.js";import{G as D,R as T}from"./router-CNc1cZ8U.js";import{W as S}from"./wifi-Du6kY9iz.js";import{C as H}from"./circle-check-big-BGF5XEJH.js";import{C as B}from"./chevron-right-BcFNkl3W.js";import{T as R}from"./trending-down-DZ6KGRir.js";import{T as y}from"./trending-up-CMx7OwOq.js";import{C as A}from"./calendar-BlkOUKUw.js";import{R as L}from"./refresh-cw-D6337zsv.js";import"./vendor-7Rr5RJ8N.js";function M(a){return a<-.6?"var(--g-red)":a<-.4?"var(--g-orange)":a<-.2?"var(--g-blue)":"var(--g-green)"}function P(a){return a>100?"var(--g-red)":a>50?"var(--g-orange)":a>20?"var(--g-blue)":"var(--g-green)"}function F({hops:a}){const{t}=d();if(a.length===0)return e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:[e.jsx(m,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--g-text-secondary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:t("rootCause.noTopologyData")}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:t("rootCause.runTopologyScans")})]});const r=a.filter(s=>s.is_bottleneck);return e.jsxs("div",{className:"space-y-4",children:[r.length>0&&e.jsxs("div",{className:"p-3 rounded-lg flex items-center gap-2",style:{background:"var(--g-orange-tint)"},children:[e.jsx(v,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--g-orange)"}}),e.jsxs("p",{className:"text-sm",style:{color:"var(--g-text)"},children:[e.jsx("strong",{children:r.length})," ",t(r.length>1?"rootCause.potentialBottlenecksPlural":"rootCause.potentialBottlenecks")," ",t(r.length>1?"rootCause.detectedAtPlural":"rootCause.detectedAt")," ",r.map(s=>s.hop_number).join(", ")]})]}),e.jsx("div",{className:"relative",children:a.map((s,o)=>{var n;const l=P(s.avg_latency_ms),c=M(s.latency_correlation);return e.jsxs("div",{className:"relative",children:[o<a.length-1&&e.jsx("div",{className:"absolute left-4 top-10 w-0.5 h-6",style:{background:"var(--g-card-bg)"}}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg mb-2",style:{background:s.is_bottleneck?"var(--g-red-tint)":"var(--g-card-bg)",boxShadow:s.is_bottleneck?"inset 0 0 0 2px var(--g-red)":void 0},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:s.is_local?"var(--g-blue-tint)":s.is_bottleneck?"var(--g-red-tint)":"var(--g-card-bg)"},children:s.is_local?e.jsx(w,{className:"w-4 h-4",style:{color:"var(--g-blue)"}}):s.hop_number===((n=a[a.length-1])==null?void 0:n.hop_number)?e.jsx(m,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}):e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--g-text-secondary)"},children:s.hop_number})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",style:{color:"var(--g-text)"},children:s.hostname||s.ip_address||`Hop ${s.hop_number}`}),s.is_local&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:"var(--g-blue-tint)",color:"var(--g-blue)"},children:t("topology.local")}),s.is_bottleneck&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:"var(--g-red)",color:"white"},children:t("rootCause.bottleneck")})]}),s.ip_address&&s.hostname&&e.jsx("p",{className:"text-xs truncate",style:{color:"var(--g-text-secondary)"},children:s.ip_address})]}),e.jsxs("div",{className:"flex items-center gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:t("connectionHealth.latency")}),e.jsxs("p",{className:"text-sm font-medium",style:{color:l},children:[s.avg_latency_ms.toFixed(1),t("common.ms")]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:t("rootCause.correlation")}),e.jsx("p",{className:"text-sm font-medium",style:{color:c},children:s.latency_correlation.toFixed(2)})]}),s.packet_loss_pct>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:t("history.packetLoss")}),e.jsxs("p",{className:"text-sm font-medium",style:{color:"var(--g-red)"},children:[s.packet_loss_pct.toFixed(1),"%"]})]})]})]})]},s.hop_number)})}),e.jsx("div",{className:"text-xs p-3 rounded-lg",style:{background:"var(--g-card-bg)"},children:e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:t("rootCause.correlationExplanation")})})]})}const I=[{key:"dns_score",labelKey:"rootCause.dns",icon:D},{key:"local_network_score",labelKey:"rootCause.localNetwork",icon:T},{key:"isp_backbone_score",labelKey:"rootCause.ispBackbone",icon:j},{key:"isp_lastmile_score",labelKey:"rootCause.ispLastMile",icon:S},{key:"server_score",labelKey:"rootCause.server",icon:m}];function K(a){return a>=80?"var(--g-green)":a>=60?"var(--g-blue)":a>=40?"var(--g-orange)":"var(--g-red)"}function G({scores:a}){const{t}=d();return e.jsx("div",{className:"space-y-3",children:I.map(({key:r,labelKey:s,icon:o})=>{const l=a[r],c=K(l);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{className:"w-3.5 h-3.5",style:{color:"var(--g-text-secondary)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-text)"},children:t(s)})]}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c},children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full overflow-hidden",style:{background:"var(--g-card-bg)"},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${l}%`,background:c}})})]},r)})})}function W(a){return a>=80?"var(--g-green)":a>=60?"var(--g-blue)":a>=40?"var(--g-orange)":"var(--g-red)"}function $(a){return a>=90?"rootCause.excellent":a>=80?"rootCause.good":a>=60?"rootCause.fair":a>=40?"rootCause.poor":"rootCause.critical"}function E({score:a,className:t=""}){const{t:r}=d(),s=W(a),o=$(a),l=2*Math.PI*45,c=l-a/100*l;return e.jsxs("div",{className:`flex flex-col items-center ${t}`,children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--g-card-bg)",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:s,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:l,strokeDashoffset:c,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-3xl font-bold",style:{color:s},children:Math.round(a)}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"/ 100"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx(x,{className:"w-4 h-4",style:{color:s}}),e.jsx("span",{className:"text-sm font-medium",style:{color:s},children:r(o)})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:r("rootCause.networkHealthScore")})]})}const z={dns:"rootCause.dns",local_network:"rootCause.localNetwork",isp_backbone:"rootCause.ispBackbone",isp_lastmile:"rootCause.ispLastMile",server:"rootCause.server",time_based:"rootCause.timeBasedPatterns",outages:"statistics.outages",connection:"latestResult.connectionType"},Z={critical:{icon:b,color:"var(--g-red)",bgColor:"var(--g-red-tint)",label:"rootCause.critical"},warning:{icon:v,color:"var(--g-orange)",bgColor:"var(--g-orange-tint)",label:"rootCause.warning"},info:{icon:f,color:"var(--g-blue)",bgColor:"var(--g-blue-tint)",label:"rootCause.info"}};function u({fingerprint:a,isPrimary:t=!1}){const{t:r}=d(),s=Z[a.severity],o=s.icon;return e.jsx("div",{className:"p-4 rounded-lg",style:{background:s.bgColor,boxShadow:t?`inset 0 0 0 2px ${s.color}`:void 0},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{background:`${s.color}20`},children:e.jsx(o,{className:"w-5 h-5",style:{color:s.color}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:s.color,color:"white"},children:r("rootCause.primaryCause")}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{background:"var(--g-card-bg)",color:"var(--g-text-secondary)"},children:r(z[a.category]||a.category)}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{background:s.color+"30",color:s.color},children:r(s.label)})]}),e.jsx("p",{className:"text-sm font-medium mt-2",style:{color:"var(--g-text)"},children:a.description}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-xs",style:{color:"var(--g-text-secondary)"},children:[e.jsxs("span",{children:[r("rootCause.confidence"),": ",e.jsxs("strong",{style:{color:s.color},children:[Math.round(a.confidence*100),"%"]})]}),a.occurrence_count>1&&e.jsxs("span",{children:[r("rootCause.occurrences"),": ",e.jsx("strong",{children:a.occurrence_count})]})]}),a.evidence.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsxs("p",{className:"text-xs font-medium",style:{color:"var(--g-text-secondary)"},children:[r("rootCause.evidence"),":"]}),e.jsx("ul",{className:"text-xs space-y-0.5",style:{color:"var(--g-text)"},children:a.evidence.map((l,c)=>e.jsxs("li",{className:"flex items-start gap-1.5",children:[e.jsx("span",{style:{color:s.color},children:"â€¢"}),l]},c))})]})]})]})})}const O={easy:{color:"var(--g-green)",bgColor:"var(--g-green-tint)",label:"rootCause.easy"},moderate:{color:"var(--g-orange)",bgColor:"var(--g-orange-tint)",label:"rootCause.moderate"},advanced:{color:"var(--g-red)",bgColor:"var(--g-red-tint)",label:"rootCause.advanced"}};function U({recommendations:a}){const{t}=d();return a.length===0?e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:[e.jsx(H,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--g-green)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:t("rootCause.noRecommendations")})]}):e.jsx("div",{className:"space-y-3",children:a.map((r,s)=>{const o=O[r.difficulty];return e.jsx("div",{className:"p-4 rounded-lg",style:{background:"var(--g-card-bg)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 text-sm font-bold",style:{background:s===0?"var(--g-blue)":"var(--g-card-bg)",color:s===0?"white":"var(--g-text-secondary)",border:s===0?"none":"1px solid var(--g-card-bg)"},children:r.priority}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--g-text)"},children:r.title}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:o.bgColor,color:o.color},children:t(o.label)})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--g-text-secondary)"},children:r.description}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(B,{className:"w-3 h-3",style:{color:"var(--g-green)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-green)"},children:r.expected_impact})]})]})]})},s)})})}function V({pattern:a}){const{t}=d();if(!a)return e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:[e.jsx(N,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--g-text-secondary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:t("rootCause.notEnoughTimeData")}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:t("rootCause.moreTimeMeasurementsNeeded")})]});const r=a.degradation_pct>0,s=r?R:y,o=r?"var(--g-orange)":"var(--g-green)";return e.jsxs("div",{className:"p-4 rounded-lg",style:{background:r?"var(--g-orange-tint)":"var(--g-green-tint)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(s,{className:"w-5 h-5",style:{color:o}}),e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--g-text)"},children:t(r?"rootCause.peakHourDegradation":"rootCause.peakHourImprovement")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:t("rootCause.peakHours")}),e.jsxs("p",{className:"text-lg font-semibold",style:{color:r?"var(--g-orange)":"var(--g-text)"},children:[a.peak_avg_download_mbps.toFixed(1)," ",e.jsx("span",{className:"text-xs font-normal",children:t("common.mbps")})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:t("rootCause.offPeak")}),e.jsxs("p",{className:"text-lg font-semibold",style:{color:r?"var(--g-text)":"var(--g-green)"},children:[a.offpeak_avg_download_mbps.toFixed(1)," ",e.jsx("span",{className:"text-xs font-normal",children:t("common.mbps")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:[t("rootCause.difference"),":"]}),e.jsxs("span",{className:"text-sm font-semibold",style:{color:o},children:[r?"-":"+",Math.abs(a.degradation_pct).toFixed(1),"%"]})]}),e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded",style:{background:"var(--g-card-bg)",color:"var(--g-text-secondary)"},children:[t("rootCause.confidence"),": ",Math.round(a.confidence*100),"%"]})]})]})}const q=[{value:7,label:"7 Days"},{value:14,label:"14 Days"},{value:30,label:"30 Days"},{value:60,label:"60 Days"},{value:90,label:"90 Days"}];function de(){const{t:a}=d(),[t,r]=p.useState(30),{data:s,isLoading:o,refetch:l,isFetching:c}=C({days:t});return e.jsxs("div",{className:"p-4 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-semibold flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(_,{className:"w-5 h-5",style:{color:"var(--g-text-secondary)"}}),a("rootCause.title")]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--g-text-secondary)"},children:a("rootCause.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}),e.jsx("select",{value:t,onChange:n=>r(Number(n.target.value)),className:"text-sm rounded-lg px-3 py-1.5 border-none outline-none",style:{background:"var(--g-card-bg)",color:"var(--g-text)"},children:q.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs(k,{variant:"default",onClick:()=>l(),disabled:c,children:[c?e.jsx(g,{size:16}):e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2 hidden sm:inline",children:a("rootCause.refresh")})]})]})]}),o?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(g,{size:32})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(i,{className:"g-stagger-1 lg:col-span-1",children:e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx(E,{score:s.network_health_score}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:[a("rootCause.basedOn",{count:s.measurement_count}),s.topology_count>0&&` ${a("rootCause.andTopology",{count:s.topology_count})}`]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:a("rootCause.analysisWindow",{days:s.data_window_days})})]})]})}),e.jsxs(i,{className:"g-stagger-2 lg:col-span-2",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-4 flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(y,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}),a("rootCause.layerHealthBreakdown")]}),e.jsx(G,{scores:s.layer_scores})]})]}),s.primary_cause&&e.jsxs(i,{className:"g-stagger-3",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-4 flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(x,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}),a("rootCause.primaryDiagnosis")]}),e.jsx(u,{fingerprint:s.primary_cause,isPrimary:!0})]}),s.secondary_causes.length>0&&e.jsxs(i,{className:"g-stagger-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:[a("rootCause.additionalIssues")," (",s.secondary_causes.length,")"]}),e.jsx("div",{className:"space-y-3",children:s.secondary_causes.map((n,h)=>e.jsx(u,{fingerprint:n},h))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{className:"g-stagger-5",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:a("rootCause.timeBasedPatterns")}),e.jsx(V,{pattern:s.time_pattern})]}),e.jsxs(i,{className:"g-stagger-6",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:a("rootCause.connectionTypeImpact")}),s.connection_impact?e.jsxs("div",{className:"p-4 rounded-lg",style:{background:s.connection_impact.has_significant_difference?"var(--g-orange-tint)":"var(--g-green-tint)"},children:[e.jsx("p",{className:"text-sm",style:{color:"var(--g-text)"},children:s.connection_impact.recommendation}),s.connection_impact.has_significant_difference&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:a("rootCause.best")}),e.jsx("p",{className:"text-sm font-medium capitalize",style:{color:"var(--g-green)"},children:s.connection_impact.best_connection})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:a("rootCause.worst")}),e.jsx("p",{className:"text-sm font-medium capitalize",style:{color:"var(--g-orange)"},children:s.connection_impact.worst_connection})]})]})]}):e.jsx("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:a("rootCause.notEnoughConnectionData")})})]})]}),s.hop_correlations.length>0&&e.jsxs(i,{className:"g-stagger-7",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:a("rootCause.hopSpeedCorrelationAnalysis")}),e.jsx(F,{hops:s.hop_correlations})]}),e.jsxs(i,{className:"g-stagger-8",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:a("rootCause.recommendations")}),e.jsx(U,{recommendations:s.recommendations})]})]}):e.jsx(i,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(x,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--g-text-secondary)"}}),e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--g-text)"},children:a("rootCause.noAnalysisAvailable")}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--g-text-secondary)"},children:a("rootCause.noData")})]})})]})}export{de as RootCausePage};
