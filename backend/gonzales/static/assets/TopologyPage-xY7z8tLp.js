import{j as e,a as b}from"./query-CSQiZfg4.js";import{c as m,r as k,s as _,t as w,v as C,S as y,N as v,P as L}from"./index-DsJiGjG0.js";import{H as u}from"./house-D9R_6U76.js";import{T as i,C as g}from"./triangle-alert-tRUlU6I8.js";import{S as H}from"./server-Bnjv3XXh.js";import{C as x}from"./circle-check-big-hsrvVK6D.js";import{I as T}from"./info-Du45l3Ig.js";import"./vendor-7Rr5RJ8N.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],A=m("globe",S);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],z=m("history",M);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",key:"w68u3i"}],["path",{d:"M6.01 18H6",key:"19vcac"}],["path",{d:"M10.01 18H10",key:"uamcmx"}],["path",{d:"M15 10v4",key:"qjz1xs"}],["path",{d:"M17.84 7.17a4 4 0 0 0-5.66 0",key:"1rif40"}],["path",{d:"M20.66 4.34a8 8 0 0 0-11.31 0",key:"6a5xfq"}]],F=m("router",D);function P(a,o){return o||a===null?"var(--g-text-secondary)":a<20?"var(--g-green)":a<50?"var(--g-amber)":"var(--g-red)"}function I(a){switch(a){case"ok":return{color:"var(--g-green)",label:"OK"};case"high_latency":return{color:"var(--g-amber)",label:"High Latency"};case"packet_loss":return{color:"var(--g-red)",label:"Packet Loss"};case"timeout":return{color:"var(--g-text-secondary)",label:"Timeout"};default:return{color:"var(--g-text-secondary)",label:a}}}function R({hop:a}){return a.hop_number===1?e.jsx("span",{title:"Local gateway (your router)",children:e.jsx(u,{className:"w-5 h-5",style:{color:"var(--g-blue)"}})}):a.is_local?e.jsx("span",{title:"Local network device",children:e.jsx(F,{className:"w-5 h-5",style:{color:"var(--g-purple)"}})}):a.is_timeout?e.jsx("span",{title:"No response (may be blocked)",children:e.jsx(g,{className:"w-5 h-5",style:{color:"var(--g-text-secondary)"}})}):e.jsx("span",{title:"Internet server/router",children:e.jsx(H,{className:"w-5 h-5",style:{color:"var(--g-cyan)"}})})}function B({hops:a,bottleneckHop:o}){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--g-blue)",opacity:.2},children:e.jsx(u,{className:"w-5 h-5",style:{color:"var(--g-blue)"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:"Your Device"}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Starting point"})]})]}),a.map((s,r)=>{const t=s.hop_number===o,c=P(s.latency_ms,s.is_timeout),n=I(s.status);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 -top-2 w-0.5 h-4",style:{backgroundColor:"var(--g-border)"}}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg transition-all",style:{backgroundColor:t?"rgba(234, 179, 8, 0.1)":"var(--g-surface)",boxShadow:t?"0 0 0 2px var(--g-amber)":void 0},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",style:{backgroundColor:c,color:"var(--g-bg)",opacity:s.is_timeout?.5:1},children:s.hop_number}),e.jsx(R,{hop:s})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",style:{color:s.is_timeout?"var(--g-text-secondary)":"var(--g-text)"},children:s.hostname||s.ip_address||"* * *"}),t&&e.jsxs("span",{className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:"rgba(234, 179, 8, 0.2)",color:"var(--g-amber)"},children:[e.jsx(i,{className:"w-3 h-3"}),"Bottleneck"]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:"var(--g-text-secondary)"},children:[s.ip_address&&s.hostname&&e.jsx("span",{children:s.ip_address}),s.is_local&&e.jsx("span",{className:"px-1.5 py-0.5 rounded",style:{backgroundColor:"rgba(139, 92, 246, 0.2)",color:"var(--g-purple)"},children:"Local"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:c},children:s.is_timeout?"---":s.latency_ms!==null?`${s.latency_ms.toFixed(1)}`:"---"}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"ms"})]}),s.packet_loss_pct>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold",style:{color:"var(--g-red)"},children:[s.packet_loss_pct.toFixed(0),"%"]}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"loss"})]}),e.jsx("div",{className:"px-2 py-1 rounded text-xs font-medium cursor-help",style:{backgroundColor:`${n.color}20`,color:n.color},title:s.status==="ok"?"Response time within normal range":s.status==="high_latency"?"Response time above 50ms - may indicate congestion":s.status==="packet_loss"?"Some packets lost - network instability":s.status==="timeout"?"No response - node may block ICMP or be unreachable":"",children:n.label})]})]}),r<a.length-1&&e.jsx("div",{className:"absolute left-5 bottom-0 w-0.5 h-2",style:{backgroundColor:"var(--g-border)"}})]},s.hop_number)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 -top-2 w-0.5 h-4",style:{backgroundColor:"var(--g-border)"}}),e.jsxs("div",{className:"flex items-center gap-3 p-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--g-green)",opacity:.2},children:e.jsx(A,{className:"w-5 h-5",style:{color:"var(--g-green)"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:"Destination"}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Target reached"})]})]})]})]})}function $({entries:a,selectedId:o,onSelect:s}){return e.jsx("div",{className:"space-y-2",children:a.map(r=>{const t=o===r.id,c=new Date(r.timestamp);return e.jsx("button",{onClick:()=>s(r),className:"w-full text-left p-3 rounded-lg transition-all",style:{backgroundColor:t?"var(--g-accent-dim)":"var(--g-surface)",boxShadow:t?"0 0 0 2px var(--g-accent)":void 0},children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r.local_network_ok?e.jsx(x,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--g-green)"}}):e.jsx(i,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--g-red)"}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:"var(--g-text)"},children:r.target_host})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--g-text-secondary)"},children:[e.jsx(g,{className:"w-3 h-3"}),c.toLocaleDateString()," ",c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--g-text)"},children:[r.total_hops," hops"]}),e.jsxs("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:[r.total_latency_ms.toFixed(0)," ms"]})]})]})},r.id)})})}function Y(){const{data:a,isLoading:o}=k(),{data:s,isLoading:r}=_(5),{data:t,isLoading:c}=w(7),n=C(),[p,h]=b.useState(null),l=p||a,j=o||r||c,N=()=>{n.mutate()};return j?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(y,{size:32})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between g-animate-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5",style:{color:"var(--g-accent)"}}),e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:"Network Topology"})]}),e.jsxs("button",{type:"button",onClick:N,disabled:n.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 flex-shrink-0 hover:opacity-90",style:{backgroundColor:"#22c55e",color:"#ffffff",minWidth:"140px"},children:[n.isPending?e.jsx(y,{size:16}):e.jsx(L,{className:"w-4 h-4"}),"Analyze Now"]})]}),t&&t.total_analyses>0&&e.jsxs("div",{className:"glass-card p-6 g-animate-in g-stagger-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:"Network Health (Last 7 Days)"}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:t.overall_status==="healthy"?"rgba(34, 197, 94, 0.2)":t.overall_status==="degraded"?"rgba(234, 179, 8, 0.2)":"rgba(239, 68, 68, 0.2)",color:t.overall_status==="healthy"?"var(--g-green)":t.overall_status==="degraded"?"var(--g-amber)":"var(--g-red)"},children:[t.overall_status==="healthy"&&e.jsx(x,{className:"w-4 h-4 inline mr-1"}),t.overall_status==="degraded"&&e.jsx(i,{className:"w-4 h-4 inline mr-1"}),t.overall_status==="problematic"&&e.jsx(i,{className:"w-4 h-4 inline mr-1"}),t.overall_status.charAt(0).toUpperCase()+t.overall_status.slice(1)]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{title:"Percentage of analyses where local network hops had acceptable latency",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:"Local Network Health"}),e.jsxs("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:[t.local_network_health_pct.toFixed(0),"%"]})]}),e.jsxs("div",{title:"Average number of network hops to reach the target",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:"Avg Hops"}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:t.avg_total_hops.toFixed(1)})]}),e.jsxs("div",{title:"Average total round-trip time across all hops",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:"Avg Latency"}),e.jsxs("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:[t.avg_total_latency_ms.toFixed(1)," ms"]})]}),e.jsxs("div",{title:"Total number of traceroute analyses performed",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:"Analyses"}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:t.total_analyses})]})]}),t.recommendations.length>0&&e.jsxs("div",{className:"mt-4 pt-4",style:{borderTop:"1px solid var(--g-border)"},children:[e.jsx("p",{className:"text-sm font-medium mb-2",style:{color:"var(--g-text)"},children:"Recommendations"}),e.jsx("ul",{className:"space-y-1",children:t.recommendations.map((d,f)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",style:{color:"var(--g-text-secondary)"},children:[e.jsx(T,{className:"w-4 h-4 flex-shrink-0 mt-0.5",style:{color:"var(--g-amber)"}}),d]},f))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 glass-card p-6 g-animate-in g-stagger-2",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:"Route Analysis"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:["Target: ",l.target_host]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--g-text-secondary)"},children:[e.jsx(g,{className:"w-4 h-4"}),new Date(l.timestamp).toLocaleString()]})]}),e.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2",style:{backgroundColor:l.local_network_ok?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)"},children:[l.local_network_ok?e.jsx(x,{className:"w-5 h-5",style:{color:"var(--g-green)"}}):e.jsx(i,{className:"w-5 h-5",style:{color:"var(--g-red)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:l.local_network_ok?"var(--g-green)":"var(--g-red)"},children:l.diagnosis})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{backgroundColor:"var(--g-surface)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Total Hops"}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:l.total_hops})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{backgroundColor:"var(--g-surface)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Total Latency"}),e.jsxs("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:[l.total_latency_ms.toFixed(1)," ms"]})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{backgroundColor:"var(--g-surface)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Bottleneck"}),e.jsx("p",{className:"text-xl font-bold",style:{color:l.bottleneck_hop?"var(--g-amber)":"var(--g-green)"},children:l.bottleneck_hop?`Hop ${l.bottleneck_hop}`:"None"})]})]}),e.jsx(B,{hops:l.hops,bottleneckHop:l.bottleneck_hop})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--g-text-secondary)"}}),e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:'No topology analysis available yet. Click "Analyze Now" to trace your network route.'})]})}),e.jsxs("div",{className:"glass-card p-6 g-animate-in g-stagger-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(z,{className:"w-5 h-5",style:{color:"var(--g-text-secondary)"}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:"Recent Analyses"})]}),s&&s.entries.length>0?e.jsx($,{entries:s.entries,selectedId:l==null?void 0:l.id,onSelect:d=>{d.id,a==null||a.id,h(null)}}):e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:"No analysis history yet."})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm g-animate-in g-stagger-4",style:{color:"var(--g-text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-green)"}}),e.jsx("span",{children:"<20ms (Excellent)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-amber)"}}),e.jsx("span",{children:"20-50ms (Good)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-red)"}}),e.jsx("span",{children:">50ms (High)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-text-secondary)"}}),e.jsx("span",{children:"Timeout"})]})]})]})}export{Y as TopologyPage};
