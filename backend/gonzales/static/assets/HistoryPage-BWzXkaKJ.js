import{a as m,j as e}from"./query-CSQiZfg4.js";import{c as M,u as _,T as E,X as S,k as N,e as A,l as L,m as F,n as z,S as I}from"./index-Cc5-1RId.js";import{G as R}from"./GlassCard-D-K6o67A.js";import{D as H}from"./DateRangeFilter-BudEyRAF.js";import{f as D}from"./format-Bm42Q-0N.js";import{A as $,a as K}from"./arrow-up-M06ytjfA.js";import"./vendor-7Rr5RJ8N.js";import"./calendar-BlkOUKUw.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],P=M("arrow-up-down",U);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],k=M("trash-2",V);function G({isOpen:n,onClose:i,onConfirm:d,isPending:o,totalCount:r}){const{t:a}=_(),[l,t]=m.useState(""),h="DELETE",u=m.useRef(null),p=m.useRef(null);if(m.useEffect(()=>{if(!n)return;p.current=document.activeElement;const c=s=>{if(s.key==="Escape"){i();return}if(s.key==="Tab"&&u.current){const b=u.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),v=b[0],g=b[b.length-1];s.shiftKey&&document.activeElement===v?(s.preventDefault(),g==null||g.focus()):!s.shiftKey&&document.activeElement===g&&(s.preventDefault(),v==null||v.focus())}};return document.addEventListener("keydown",c),()=>{var s;document.removeEventListener("keydown",c),(s=p.current)==null||s.focus()}},[n,i]),!n)return null;const y=l.toUpperCase()===h,f=()=>{y&&(d(),t(""))},j=()=>{t(""),i()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{background:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)"},onClick:j,role:"presentation",children:e.jsxs("div",{ref:u,className:"w-full max-w-md rounded-xl p-6 shadow-xl",style:{background:"var(--g-glass)",border:"1px solid var(--g-border)"},onClick:c=>c.stopPropagation(),role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title","aria-describedby":"delete-modal-description",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{background:"var(--g-red)20"},children:e.jsx(E,{className:"w-5 h-5",style:{color:"var(--g-red)"}})}),e.jsx("h3",{id:"delete-modal-title",className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:a("history.deleteAllTitle")})]}),e.jsx("button",{onClick:j,className:"p-1 rounded-lg transition-colors",style:{color:"var(--g-text-secondary)"},onMouseEnter:c=>c.currentTarget.style.background="var(--g-border)",onMouseLeave:c=>c.currentTarget.style.background="transparent","aria-label":a("history.closeDialog"),children:e.jsx(S,{className:"w-5 h-5","aria-hidden":"true"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{id:"delete-modal-description",style:{color:"var(--g-text-secondary)"},dangerouslySetInnerHTML:{__html:a("history.deleteAllWarning",{count:r})}}),e.jsx("div",{className:"p-3 rounded-lg",style:{background:"var(--g-red)08",border:"1px solid var(--g-red)30"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--g-red)"},children:a("history.deleteAllWarningLong")})}),e.jsx("div",{children:e.jsx("label",{className:"block text-sm mb-2",style:{color:"var(--g-text-secondary)"},dangerouslySetInnerHTML:{__html:a("history.typeToConfirm",{word:h})}})}),e.jsx("div",{children:e.jsx("input",{type:"text",value:l,onChange:c=>t(c.target.value),placeholder:h,className:"w-full px-3 py-2 rounded-lg text-sm",style:{background:"var(--g-input-bg)",border:"1px solid var(--g-border)",color:"var(--g-text)"},autoFocus:!0})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(N,{onClick:j,className:"flex-1",children:a("history.cancel")}),e.jsxs(N,{onClick:f,disabled:!y||o,className:"flex-1",style:{background:y?"var(--g-red)":void 0,color:y?"white":void 0,opacity:y?1:.5},children:[e.jsx(k,{className:"w-4 h-4"}),a(o?"history.deleting":"history.deleteAll")]})]})]})]})})}function w({label:n,field:i,sortBy:d,sortOrder:o,onSort:r,align:a="right"}){const l=d===i,t=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),r==null||r(i))};return e.jsx("th",{className:`py-3 px-3 font-medium cursor-pointer select-none transition-colors ${a==="left"?"text-left":"text-right"}`,style:{color:"var(--g-text-secondary)",fontSize:"var(--g-text-xs)"},onClick:()=>r==null?void 0:r(i),onKeyDown:t,tabIndex:0,role:"columnheader","aria-sort":l?o==="asc"?"ascending":"descending":"none",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[n,l?o==="asc"?e.jsx($,{className:"w-3 h-3","aria-hidden":"true"}):e.jsx(K,{className:"w-3 h-3","aria-hidden":"true"}):e.jsx(P,{className:"w-3 h-3 opacity-40","aria-hidden":"true"})]})})}const W=m.memo(function({measurements:i,onDelete:d,sortBy:o,sortOrder:r,onSort:a}){const{t:l}=_();return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"glass-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx(w,{label:l("history.timestamp"),field:"timestamp",sortBy:o,sortOrder:r,onSort:a,align:"left"}),e.jsx(w,{label:l("history.downloadSpeed"),field:"download_mbps",sortBy:o,sortOrder:r,onSort:a}),e.jsx(w,{label:l("history.uploadSpeed"),field:"upload_mbps",sortBy:o,sortOrder:r,onSort:a}),e.jsx(w,{label:l("history.pingLatency"),field:"ping_latency_ms",sortBy:o,sortOrder:r,onSort:a}),e.jsx(w,{label:l("history.jitter"),field:"ping_jitter_ms",sortBy:o,sortOrder:r,onSort:a}),e.jsx("th",{className:"text-left py-3 px-3 font-medium",style:{color:"var(--g-text-secondary)",fontSize:"var(--g-text-xs)"},children:l("history.serverName")}),e.jsx("th",{className:"text-center py-3 px-3 font-medium",style:{color:"var(--g-text-secondary)",fontSize:"var(--g-text-xs)"},title:l("history.issuesTitle"),children:l("history.issues")}),e.jsx("th",{className:"py-3 px-3"})]})}),e.jsx("tbody",{children:i.map((t,h)=>{const u=t.below_download_threshold||t.below_upload_threshold;return e.jsxs("tr",{className:"g-animate-in",style:{animationDelay:`${Math.min(h*30,300)}ms`,background:u?"rgba(255, 59, 48, 0.05)":void 0},children:[e.jsx("td",{className:"py-2.5 px-3",style:{color:"var(--g-text)"},children:D(t.timestamp)}),e.jsx("td",{className:"py-2.5 px-3 text-right font-medium tabular-nums",style:{color:"var(--g-blue)"},children:t.download_mbps.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 text-right font-medium tabular-nums",style:{color:"var(--g-green)"},children:t.upload_mbps.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 text-right tabular-nums",style:{color:"var(--g-text)"},children:t.ping_latency_ms.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 text-right tabular-nums",style:{color:"var(--g-text)"},children:t.ping_jitter_ms.toFixed(1)}),e.jsx("td",{className:"py-2.5 px-3 max-w-[150px] truncate",style:{color:"var(--g-text-secondary)"},children:t.server_name}),e.jsx("td",{className:"py-2.5 px-3 text-center",children:u&&e.jsxs("span",{className:"text-xs font-medium cursor-help",style:{color:"var(--g-red)"},title:`${t.below_download_threshold?l("history.belowDownloadThreshold"):""}${t.below_download_threshold&&t.below_upload_threshold?", ":""}${t.below_upload_threshold?l("history.belowUploadThreshold"):""}`,children:[t.below_download_threshold&&"DL",t.below_download_threshold&&t.below_upload_threshold&&" / ",t.below_upload_threshold&&"UL"]})}),e.jsx("td",{className:"py-2.5 px-3",children:d&&e.jsx("button",{onClick:()=>d(t.id),className:"glass-focus-ring rounded transition-colors",style:{color:"var(--g-text-secondary)"},title:l("history.deleteMeasurement"),"aria-label":l("history.deleteMeasurementFrom",{time:D(t.timestamp)}),onMouseEnter:p=>p.currentTarget.style.color="var(--g-red)",onMouseLeave:p=>p.currentTarget.style.color="var(--g-text-secondary)",children:e.jsx(k,{className:"w-4 h-4","aria-hidden":"true"})})})]},t.id)})})]})})});function ee(){const{t:n}=_(),[i,d]=m.useState(1),[o,r]=m.useState(""),[a,l]=m.useState(""),[t,h]=m.useState("timestamp"),[u,p]=m.useState("desc"),[y,f]=m.useState(!1),j=x=>{x===t?p(T=>T==="asc"?"desc":"asc"):(h(x),p("desc")),d(1)},c={page:i,page_size:25,start_date:o?new Date(o).toISOString():void 0,end_date:a?new Date(a).toISOString():void 0,sort_by:t,sort_order:u},{data:s,isLoading:b}=A(c),v=L(),g=F(),C=()=>{g.mutate(void 0,{onSuccess:()=>{f(!1),d(1)}})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between g-animate-in",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(z,{className:"w-5 h-5"}),n("history.title")]}),e.jsx(H,{startDate:o,endDate:a,onStartDateChange:x=>{r(x),d(1)},onEndDateChange:x=>{l(x),d(1)}})]}),e.jsx(R,{padding:"none",className:"g-animate-in g-stagger-1",children:e.jsx("div",{className:"p-5",children:b?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(I,{size:32})}):s&&s.items.length>0?e.jsxs(e.Fragment,{children:[e.jsx(W,{measurements:s.items,onDelete:x=>v.mutate(x),sortBy:t,sortOrder:u,onSort:j}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",style:{borderColor:"var(--g-border)"},children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:n("history.totalMeasurements",{count:s.total})}),e.jsxs(N,{size:"sm",onClick:()=>f(!0),style:{color:"var(--g-red)"},children:[e.jsx(k,{className:"w-3 h-3"}),n("history.deleteAll")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{size:"sm",onClick:()=>d(x=>Math.max(1,x-1)),disabled:i<=1,children:n("history.previous")}),e.jsx("span",{className:"text-xs px-2 py-1",style:{color:"var(--g-text-secondary)"},children:n("history.page",{current:s.page,total:s.pages})}),e.jsx(N,{size:"sm",onClick:()=>d(x=>Math.min(s.pages,x+1)),disabled:i>=s.pages,children:n("history.next")})]})]})]}):e.jsx("p",{className:"text-center py-12",style:{color:"var(--g-text-secondary)"},children:n("history.noHistory")})})}),e.jsx(G,{isOpen:y,onClose:()=>f(!1),onConfirm:C,isPending:g.isPending,totalCount:(s==null?void 0:s.total)??0})]})}export{ee as HistoryPage};
