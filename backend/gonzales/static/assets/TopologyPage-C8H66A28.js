import{j as e,a as k}from"./query-CSQiZfg4.js";import{c as _,u as m,T as d,n as y,Q as w,R as C,U as L,V as S,S as h,W as v,P as H,I as T}from"./index-Cc5-1RId.js";import{H as u}from"./house-DhEN4A--.js";import{G as D,R}from"./router-CNc1cZ8U.js";import{S as F}from"./server-Dr4lLdfu.js";import{C as g}from"./circle-check-big-BGF5XEJH.js";import"./vendor-7Rr5RJ8N.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],A=_("history",z);function P(s,a){return a||s===null?"var(--g-text-secondary)":s<20?"var(--g-green)":s<50?"var(--g-amber)":"var(--g-red)"}function I(s,a){switch(s){case"ok":return{color:"var(--g-green)",label:a("topology.ok")};case"high_latency":return{color:"var(--g-amber)",label:a("topology.highLatency")};case"packet_loss":return{color:"var(--g-red)",label:a("topology.packetLossStatus")};case"timeout":return{color:"var(--g-text-secondary)",label:a("topology.timeoutStatus")};default:return{color:"var(--g-text-secondary)",label:s}}}function $({hop:s,t:a}){return s.hop_number===1?e.jsx("span",{title:a("topology.localGateway"),children:e.jsx(u,{className:"w-5 h-5",style:{color:"var(--g-blue)"}})}):s.is_local?e.jsx("span",{title:a("topology.localDevice"),children:e.jsx(R,{className:"w-5 h-5",style:{color:"var(--g-purple)"}})}):s.is_timeout?e.jsx("span",{title:a("topology.noResponseBlocked"),children:e.jsx(y,{className:"w-5 h-5",style:{color:"var(--g-text-secondary)"}})}):e.jsx("span",{title:a("topology.internetRouter"),children:e.jsx(F,{className:"w-5 h-5",style:{color:"var(--g-cyan)"}})})}function B({hops:s,bottleneckHop:a}){const{t:o}=m();return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3 p-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--g-blue)",opacity:.2},children:e.jsx(u,{className:"w-5 h-5",style:{color:"var(--g-blue)"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:o("topology.yourDevice")}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:o("topology.startingPoint")})]})]}),s.map((t,c)=>{const l=t.hop_number===a,n=P(t.latency_ms,t.is_timeout),i=I(t.status,o);return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 -top-2 w-0.5 h-4",style:{backgroundColor:"var(--g-border)"}}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg transition-all",style:{backgroundColor:l?"rgba(234, 179, 8, 0.1)":"var(--g-surface)",boxShadow:l?"0 0 0 2px var(--g-amber)":void 0},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",style:{backgroundColor:n,color:"var(--g-bg)",opacity:t.is_timeout?.5:1},children:t.hop_number}),e.jsx($,{hop:t,t:o})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",style:{color:t.is_timeout?"var(--g-text-secondary)":"var(--g-text)"},children:t.hostname||t.ip_address||"* * *"}),l&&e.jsxs("span",{className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded-full",style:{backgroundColor:"rgba(234, 179, 8, 0.2)",color:"var(--g-amber)"},children:[e.jsx(d,{className:"w-3 h-3"}),o("topology.bottleneck")]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",style:{color:"var(--g-text-secondary)"},children:[t.ip_address&&t.hostname&&e.jsx("span",{children:t.ip_address}),t.is_local&&e.jsx("span",{className:"px-1.5 py-0.5 rounded",style:{backgroundColor:"rgba(139, 92, 246, 0.2)",color:"var(--g-purple)"},children:o("topology.local")})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold",style:{color:n},children:t.is_timeout?"---":t.latency_ms!==null?`${t.latency_ms.toFixed(1)}`:"---"}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:o("common.ms")})]}),t.packet_loss_pct>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold",style:{color:"var(--g-red)"},children:[t.packet_loss_pct.toFixed(0),"%"]}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:o("history.packetLoss").toLowerCase()})]}),e.jsx("div",{className:"px-2 py-1 rounded text-xs font-medium cursor-help",style:{backgroundColor:`${i.color}20`,color:i.color},title:t.status==="ok"?o("topology.responseNormal"):t.status==="high_latency"?o("topology.responseLow"):t.status==="packet_loss"?o("topology.packetLossDetected"):t.status==="timeout"?o("topology.noResponse"):"",children:i.label})]})]}),c<s.length-1&&e.jsx("div",{className:"absolute left-5 bottom-0 w-0.5 h-2",style:{backgroundColor:"var(--g-border)"}})]},t.hop_number)}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 -top-2 w-0.5 h-4",style:{backgroundColor:"var(--g-border)"}}),e.jsxs("div",{className:"flex items-center gap-3 p-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--g-green)",opacity:.2},children:e.jsx(D,{className:"w-5 h-5",style:{color:"var(--g-green)"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:o("topology.destination")}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:o("topology.targetReached")})]})]})]})]})}function M({entries:s,selectedId:a,onSelect:o}){const{t}=m();return e.jsx("div",{className:"space-y-2",children:s.map(c=>{const l=a===c.id,n=new Date(c.timestamp);return e.jsx("button",{onClick:()=>o(c),className:"w-full text-left p-3 rounded-lg transition-all",style:{backgroundColor:l?"var(--g-accent-dim)":"var(--g-surface)",boxShadow:l?"0 0 0 2px var(--g-accent)":void 0},children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[c.local_network_ok?e.jsx(g,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--g-green)"}}):e.jsx(d,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--g-red)"}}),e.jsx("span",{className:"text-sm font-medium truncate",style:{color:"var(--g-text)"},children:c.target_host})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--g-text-secondary)"},children:[e.jsx(y,{className:"w-3 h-3"}),n.toLocaleDateString()," ",n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-bold",style:{color:"var(--g-text)"},children:[c.total_hops," ",t("topology.hops").toLowerCase()]}),e.jsxs("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:[c.total_latency_ms.toFixed(0)," ",t("common.ms")]})]})]})},c.id)})})}function J(){const{t:s}=m(),{data:a,isLoading:o}=w(),{data:t,isLoading:c}=C(5),{data:l,isLoading:n}=L(7),i=S(),[j,p]=k.useState(null),r=j||a,N=o||c||n,f=()=>{i.mutate()};return N?e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(h,{size:32})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between g-animate-in",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5",style:{color:"var(--g-accent)"}}),e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:s("topology.title")})]}),e.jsxs("button",{type:"button",onClick:f,disabled:i.isPending,className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 flex-shrink-0 hover:opacity-90",style:{backgroundColor:"#22c55e",color:"#ffffff",minWidth:"140px"},children:[i.isPending?e.jsx(h,{size:16}):e.jsx(H,{className:"w-4 h-4"}),s("topology.analyzeNow")]})]}),l&&l.total_analyses>0&&e.jsxs("div",{className:"glass-card p-6 g-animate-in g-stagger-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:s("topology.networkHealth")}),e.jsxs("div",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:l.overall_status==="healthy"?"rgba(34, 197, 94, 0.2)":l.overall_status==="degraded"?"rgba(234, 179, 8, 0.2)":"rgba(239, 68, 68, 0.2)",color:l.overall_status==="healthy"?"var(--g-green)":l.overall_status==="degraded"?"var(--g-amber)":"var(--g-red)"},children:[l.overall_status==="healthy"&&e.jsx(g,{className:"w-4 h-4 inline mr-1"}),l.overall_status==="degraded"&&e.jsx(d,{className:"w-4 h-4 inline mr-1"}),l.overall_status==="problematic"&&e.jsx(d,{className:"w-4 h-4 inline mr-1"}),s(`topology.${l.overall_status}`)]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{title:"Percentage of analyses where local network hops had acceptable latency",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:s("topology.localNetworkHealth")}),e.jsxs("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:[l.local_network_health_pct.toFixed(0),"%"]})]}),e.jsxs("div",{title:"Average number of network hops to reach the target",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:s("topology.avgHops")}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:l.avg_total_hops.toFixed(1)})]}),e.jsxs("div",{title:"Average total round-trip time across all hops",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:s("topology.avgLatency")}),e.jsxs("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:[l.avg_total_latency_ms.toFixed(1)," ",s("common.ms")]})]}),e.jsxs("div",{title:"Total number of traceroute analyses performed",children:[e.jsx("p",{className:"text-xs cursor-help",style:{color:"var(--g-text-secondary)"},children:s("topology.analyses")}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:l.total_analyses})]})]}),l.recommendations.length>0&&e.jsxs("div",{className:"mt-4 pt-4",style:{borderTop:"1px solid var(--g-border)"},children:[e.jsx("p",{className:"text-sm font-medium mb-2",style:{color:"var(--g-text)"},children:s("topology.recommendations")}),e.jsx("ul",{className:"space-y-1",children:l.recommendations.map((x,b)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",style:{color:"var(--g-text-secondary)"},children:[e.jsx(T,{className:"w-4 h-4 flex-shrink-0 mt-0.5",style:{color:"var(--g-amber)"}}),x]},b))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 glass-card p-6 g-animate-in g-stagger-2",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:s("topology.routeAnalysis")}),e.jsxs("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:[s("topology.target"),": ",r.target_host]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--g-text-secondary)"},children:[e.jsx(y,{className:"w-4 h-4"}),new Date(r.timestamp).toLocaleString()]})]}),e.jsxs("div",{className:"mb-4 p-3 rounded-lg flex items-center gap-2",style:{backgroundColor:r.local_network_ok?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)"},children:[r.local_network_ok?e.jsx(g,{className:"w-5 h-5",style:{color:"var(--g-green)"}}):e.jsx(d,{className:"w-5 h-5",style:{color:"var(--g-red)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:r.local_network_ok?"var(--g-green)":"var(--g-red)"},children:r.diagnosis})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{backgroundColor:"var(--g-surface)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:s("topology.totalHops")}),e.jsx("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:r.total_hops})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{backgroundColor:"var(--g-surface)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:s("topology.totalLatency")}),e.jsxs("p",{className:"text-xl font-bold",style:{color:"var(--g-text)"},children:[r.total_latency_ms.toFixed(1)," ",s("common.ms")]})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg",style:{backgroundColor:"var(--g-surface)"},children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:s("topology.bottleneck")}),e.jsx("p",{className:"text-xl font-bold",style:{color:r.bottleneck_hop?"var(--g-amber)":"var(--g-green)"},children:r.bottleneck_hop?`${s("topology.hop")} ${r.bottleneck_hop}`:s("topology.none")})]})]}),e.jsx(B,{hops:r.hops,bottleneckHop:r.bottleneck_hop})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--g-text-secondary)"}}),e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:s("topology.noData")})]})}),e.jsxs("div",{className:"glass-card p-6 g-animate-in g-stagger-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"w-5 h-5",style:{color:"var(--g-text-secondary)"}}),e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--g-text)"},children:s("topology.historyRecent")})]}),t&&t.entries.length>0?e.jsx(M,{entries:t.entries,selectedId:r==null?void 0:r.id,onSelect:x=>{x.id,a==null||a.id,p(null)}}):e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:s("topology.noAnalysisHistory")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-sm g-animate-in g-stagger-4",style:{color:"var(--g-text-secondary)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-green)"}}),e.jsx("span",{children:s("topology.excellent")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-amber)"}}),e.jsx("span",{children:s("topology.good")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-red)"}}),e.jsx("span",{children:s("topology.high")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--g-text-secondary)"}}),e.jsx("span",{children:s("topology.timeout")})]})]})]})}export{J as TopologyPage};
