import{a as u,j as e,b as J}from"./query-CSQiZfg4.js";import{c as L,G as Q,u as V,a as H,b as Z,S as ee}from"./index-XIQY-Qrv.js";import{G as v}from"./GlassCard-BeFGED1K.js";import{A as se,u as $,P as S}from"./ProgressRing-YVr79DN4.js";import{f as te,a as A}from"./format-Cx2mhIEl.js";import{R as D,L as G,C as P,X as z,Y as F,T as E,a as ae,b}from"./charts-Cmp4m8N6.js";import{A as h}from"./activity-edabFgh4.js";import{A as re,a as ne}from"./arrow-up-DrVG-_cv.js";import"./vendor-PRsJgg41.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],ie=L("gauge",oe);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],ce=L("wifi",le);function de(){const[t,s]=u.useState({phase:"idle"}),[n,r]=u.useState(!1),o=u.useRef(null),p=u.useCallback(()=>{o.current&&o.current.close(),s({phase:"idle"}),r(!0);const l=new EventSource("/api/v1/speedtest/stream");o.current=l,l.addEventListener("started",()=>{s({phase:"started"})}),l.addEventListener("progress",g=>{const a=JSON.parse(g.data);s({phase:a.phase||"started",bandwidth_mbps:a.bandwidth_mbps,progress:a.progress,ping_ms:a.ping_ms,elapsed:a.elapsed})}),l.addEventListener("complete",g=>{const a=JSON.parse(g.data);s({phase:"complete",download_mbps:a.download_mbps,upload_mbps:a.upload_mbps,ping_ms:a.ping_ms,jitter_ms:a.jitter_ms,measurement_id:a.measurement_id}),r(!1),l.close(),o.current=null}),l.addEventListener("error",g=>{if(g instanceof MessageEvent){const a=JSON.parse(g.data);s({phase:"error",message:a.message})}else s({phase:"error",message:"Connection lost"});r(!1),l.close(),o.current=null}),l.onerror=()=>{o.current===l&&(r(!1),l.close(),o.current=null)}},[]),x=u.useCallback(()=>{o.current&&(o.current.close(),o.current=null),s({phase:"idle"}),r(!1)},[]);return{progress:t,isStreaming:n,startStreaming:p,reset:x}}function w({label:t,value:s,unit:n="Mbps",color:r,threshold:o}){const p=o!==void 0&&s<o;return e.jsxs(v,{hover:!0,className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--g-text-secondary)"},children:t}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx(se,{value:s,decimals:1,className:"text-5xl font-bold tracking-tight",style:{color:p?"var(--g-red)":r}}),e.jsx("span",{className:"text-lg font-medium",style:{color:"var(--g-text-secondary)"},children:n})]}),p&&e.jsxs("p",{className:"text-xs mt-2 font-medium",style:{color:"var(--g-red)"},children:["Below threshold (",o," ",n,")"]})]})}function me({measurement:t}){return e.jsxs(v,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--g-text)"},children:"Latest Test"}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:te(t.timestamp)})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Server"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.server_name})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Location"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.server_location})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"ISP"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.isp})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Packet Loss"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.packet_loss_pct!==null?`${t.packet_loss_pct.toFixed(1)}%`:"N/A"})]})]}),t.result_url&&e.jsx("a",{href:t.result_url,target:"_blank",rel:"noopener noreferrer",className:"inline-block mt-3 text-xs hover:underline",style:{color:"var(--g-blue)"},children:"View on Speedtest.net"})]})}function xe({measurements:t}){const s=[...t].reverse().map(n=>({time:A(n.timestamp),download:Number(n.download_mbps.toFixed(1)),upload:Number(n.upload_mbps.toFixed(1))}));return e.jsxs(v,{children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Speed Over Time"}),e.jsx(D,{width:"100%",height:300,children:e.jsxs(G,{data:s,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"var(--g-border)"}),e.jsx(z,{dataKey:"time",tick:{fontSize:11},stroke:"var(--g-text-tertiary)"}),e.jsx(F,{tick:{fontSize:11},stroke:"var(--g-text-tertiary)",unit:" Mbps"}),e.jsx(E,{contentStyle:{background:"var(--g-card-bg)",border:"1px solid var(--g-card-border)",borderRadius:"var(--g-radius-sm)",backdropFilter:"blur(20px)",fontSize:"var(--g-text-xs)"}}),e.jsx(ae,{}),e.jsx(b,{type:"monotone",dataKey:"download",stroke:"var(--g-blue)",strokeWidth:2,dot:!1,name:"Download",animationDuration:800,animationBegin:0,animationEasing:"ease-out"}),e.jsx(b,{type:"monotone",dataKey:"upload",stroke:"var(--g-green)",strokeWidth:2,dot:!1,name:"Upload",animationDuration:800,animationBegin:200,animationEasing:"ease-out"})]})})]})}function pe({measurements:t}){const s=[...t].reverse().map(n=>({time:A(n.timestamp),ping:Number(n.ping_latency_ms.toFixed(1)),jitter:Number(n.ping_jitter_ms.toFixed(1))}));return e.jsxs(v,{children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Latency Over Time"}),e.jsx(D,{width:"100%",height:250,children:e.jsxs(G,{data:s,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"var(--g-border)"}),e.jsx(z,{dataKey:"time",tick:{fontSize:11},stroke:"var(--g-text-tertiary)"}),e.jsx(F,{tick:{fontSize:11},stroke:"var(--g-text-tertiary)",unit:" ms"}),e.jsx(E,{contentStyle:{background:"var(--g-card-bg)",border:"1px solid var(--g-card-border)",borderRadius:"var(--g-radius-sm)",backdropFilter:"blur(20px)",fontSize:"var(--g-text-xs)"}}),e.jsx(b,{type:"monotone",dataKey:"ping",stroke:"var(--g-orange)",strokeWidth:2,dot:!1,name:"Ping",animationDuration:800,animationBegin:0,animationEasing:"ease-out"}),e.jsx(b,{type:"monotone",dataKey:"jitter",stroke:"var(--g-purple)",strokeWidth:2,dot:!1,name:"Jitter",animationDuration:800,animationBegin:200,animationEasing:"ease-out"})]})})]})}function C({value:t,max:s=1e3,label:n="Speed",color:r="var(--g-blue)",unit:o="Mbps",glowColor:p}){const x=$(t,400),l=Math.min(x,s),g=-135+l/s*270,a=80,c=100,d=100,N=p||r,W=[0,.25,.5,.75,1].map(i=>{const m=(-135+i*270)*(Math.PI/180);return{x1:c+(a-10)*Math.cos(m),y1:d+(a-10)*Math.sin(m),x2:c+a*Math.cos(m),y2:d+a*Math.sin(m),label:Math.round(i*s),lx:c+(a-18)*Math.cos(m),ly:d+(a-18)*Math.sin(m)}}),I=Array.from({length:21},(i,m)=>{const _=m/20,y=(-135+_*270)*(Math.PI/180);return{x1:c+(a-4)*Math.cos(y),y1:d+(a-4)*Math.sin(y),x2:c+a*Math.cos(y),y2:d+a*Math.sin(y),active:_<=l/s}}),j=-135*(Math.PI/180),M=g*(Math.PI/180),T=c+a*Math.cos(j),B=d+a*Math.sin(j),R=c+a*Math.cos(M),K=d+a*Math.sin(M),O=g- -135>180?1:0,f=g*(Math.PI/180),U=c+(a-18)*Math.cos(f),X=d+(a-18)*Math.sin(f),Y=c+(a-20)*Math.cos(f),q=d+(a-20)*Math.sin(f);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{viewBox:"0 0 200 145",className:"w-full max-w-[320px]",children:[e.jsxs("defs",{children:[e.jsxs("filter",{id:"needleGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"blur"}),e.jsx("feFlood",{floodColor:N,floodOpacity:"0.6",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"glow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:"arcGlow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"blur"}),e.jsx("feFlood",{floodColor:N,floodOpacity:"0.4",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"glow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:"tipPulse",x:"-100%",y:"-100%",width:"300%",height:"300%",children:e.jsx("feGaussianBlur",{stdDeviation:"4"})}),e.jsxs("linearGradient",{id:"arcGradient",x1:"0",y1:"0",x2:"1",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:r,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:r,stopOpacity:"1"})]})]}),e.jsx("path",{d:`M ${c+a*Math.cos(j)} ${d+a*Math.sin(j)} A ${a} ${a} 0 1 1 ${c+a*Math.cos(135*Math.PI/180)} ${d+a*Math.sin(135*Math.PI/180)}`,fill:"none",stroke:"var(--g-border)",strokeWidth:"6",strokeLinecap:"round",opacity:"0.5"}),I.map((i,m)=>e.jsx("line",{x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,stroke:i.active?r:"var(--g-border)",strokeWidth:"1",strokeLinecap:"round",opacity:i.active?.8:.3},`minor-${m}`)),x>0&&e.jsx("path",{d:`M ${T} ${B} A ${a} ${a} 0 ${O} 1 ${R} ${K}`,fill:"none",stroke:"url(#arcGradient)",strokeWidth:"6",strokeLinecap:"round",filter:"url(#arcGlow)"}),W.map((i,m)=>e.jsxs("g",{children:[e.jsx("line",{x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2,stroke:"var(--g-text-tertiary)",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("text",{x:i.lx,y:i.ly,textAnchor:"middle",dominantBaseline:"middle",fill:"var(--g-text-secondary)",fontSize:"7",fontWeight:"500",children:i.label})]},`major-${m}`)),e.jsx("line",{x1:c,y1:d,x2:U,y2:X,stroke:r,strokeWidth:"2",strokeLinecap:"round",filter:"url(#needleGlow)"}),e.jsx("circle",{cx:c,cy:d,r:"5",fill:r,opacity:"0.9"}),e.jsx("circle",{cx:c,cy:d,r:"3",fill:"var(--g-bg)"}),x>0&&e.jsxs("circle",{cx:Y,cy:q,r:"6",fill:r,filter:"url(#tipPulse)",opacity:"0.5",children:[e.jsx("animate",{attributeName:"opacity",values:"0.3;0.7;0.3",dur:"1.5s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"r",values:"4;8;4",dur:"1.5s",repeatCount:"indefinite"})]})]}),e.jsxs("div",{className:"text-center -mt-3",children:[e.jsx("span",{className:"text-4xl font-bold tabular-nums",style:{color:r,textShadow:`0 0 20px ${N}40`},children:x.toFixed(1)}),e.jsx("span",{className:"text-sm ml-1",style:{color:"var(--g-text-secondary)"},children:o})]}),e.jsx("span",{className:"text-xs mt-1 font-medium uppercase tracking-wider",style:{color:"var(--g-text-tertiary)"},children:n})]})}const ge={idle:"Waiting...",started:"Initializing...",ping:"Measuring Latency",download:"Testing Download",upload:"Testing Upload",complete:"Test Complete",error:"Test Failed"},ue={idle:"var(--g-text-secondary)",started:"var(--g-teal)",ping:"var(--g-orange)",download:"var(--g-blue)",upload:"var(--g-green)",complete:"var(--g-green)",error:"var(--g-red)"},he={idle:ce,started:h,ping:h,download:ne,upload:re,complete:h,error:h};function ve({color:t,count:s=12}){return e.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none opacity-[0.07]",children:Array.from({length:s},(n,r)=>e.jsx("div",{className:"absolute h-px",style:{background:`linear-gradient(90deg, transparent, ${t}, transparent)`,top:`${8+r/s*84}%`,left:0,right:0,animation:`g-shimmer ${2+r%3*.5}s ease-in-out ${r*.15}s infinite`,backgroundSize:"200% 100%"}},r))})}function k({label:t,value:s,unit:n,color:r,delay:o}){const p=$(s,800);return e.jsx("div",{className:"flex flex-col items-center g-animate-in",style:{animationDelay:`${o}ms`},children:e.jsxs(v,{padding:"md",depth:"elevated",className:"w-full text-center",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums block",style:{color:r,textShadow:`0 0 16px ${r}30`},children:p.toFixed(1)}),e.jsx("span",{className:"text-xs block mt-1",style:{color:"var(--g-text-secondary)"},children:n}),e.jsx("span",{className:"text-xs font-medium block mt-1 uppercase tracking-wider",style:{color:"var(--g-text-tertiary)"},children:t})]})})}function je({progress:t}){const s=t.phase,n=ue[s]||"var(--g-blue)",r=he[s]||h,o=s!=="idle"&&s!=="complete"&&s!=="error";return e.jsxs(v,{padding:"none",depth:"elevated",className:"relative overflow-hidden",children:[o&&e.jsx(ve,{color:n}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-6 py-10 px-6",children:[e.jsxs(Q,{color:n,children:[o&&e.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:n,boxShadow:`0 0 8px ${n}`,animation:"g-breathe 1.5s ease-in-out infinite"}}),e.jsx(r,{className:"w-3.5 h-3.5"}),ge[s]||s]}),s==="started"&&e.jsxs("div",{className:"flex flex-col items-center gap-4 g-animate-scale",children:[e.jsx(S,{value:30,max:100,size:120,strokeWidth:4,color:"var(--g-teal)",glow:!0,children:e.jsx(h,{className:"w-8 h-8",style:{color:"var(--g-teal)",animation:"g-breathe 2s ease-in-out infinite"}})}),e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-tertiary)"},children:"Connecting to server..."})]}),s==="ping"&&e.jsx("div",{className:"flex flex-col items-center gap-3 g-animate-scale",children:e.jsx(S,{value:(t.progress||0)*100,max:100,size:140,strokeWidth:6,color:"var(--g-orange)",glow:!0,children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-3xl font-bold tabular-nums",style:{color:"var(--g-orange)",textShadow:"0 0 16px rgba(255, 149, 0, 0.3)"},children:(t.ping_ms||0).toFixed(1)}),e.jsx("span",{className:"text-xs block",style:{color:"var(--g-text-secondary)"},children:"ms"})]})})}),s==="download"&&e.jsx("div",{className:"flex flex-col items-center gap-4 g-animate-scale",children:e.jsx(C,{value:t.bandwidth_mbps||0,label:"Download",color:"var(--g-blue)",glowColor:"#007AFF"})}),s==="upload"&&e.jsx("div",{className:"flex flex-col items-center gap-4 g-animate-scale",children:e.jsx(C,{value:t.bandwidth_mbps||0,label:"Upload",color:"var(--g-green)",glowColor:"#34C759"})}),s==="complete"&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 w-full max-w-md",children:[e.jsx(k,{label:"Download",value:t.download_mbps||0,unit:"Mbps",color:"var(--g-blue)",delay:0}),e.jsx(k,{label:"Upload",value:t.upload_mbps||0,unit:"Mbps",color:"var(--g-green)",delay:100}),e.jsx(k,{label:"Ping",value:t.ping_ms||0,unit:"ms",color:"var(--g-orange)",delay:200})]}),s==="error"&&e.jsx("div",{className:"text-center g-animate-in",children:e.jsx("p",{className:"text-sm",style:{color:"var(--g-red)"},children:t.message||"An error occurred"})}),(s==="download"||s==="upload")&&t.progress!==void 0&&e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx("div",{className:"glass-progress",style:{height:6},children:e.jsx("div",{className:"glass-progress-bar",style:{width:`${Math.min(100,(t.progress||0)*100)}%`,backgroundColor:n,boxShadow:`0 0 8px ${n}60`}})}),e.jsxs("p",{className:"text-[10px] text-center mt-2 tabular-nums",style:{color:"var(--g-text-tertiary)"},children:[Math.round((t.progress||0)*100),"%"]})]})]})]})}function Ce(){const{data:t,isLoading:s}=V(),{data:n}=H({page_size:50}),{data:r}=Z(),{progress:o,isStreaming:p}=de(),x=J();if(u.useEffect(()=>{o.phase==="complete"&&(x.invalidateQueries({queryKey:["measurement"]}),x.invalidateQueries({queryKey:["measurements"]}),x.invalidateQueries({queryKey:["statistics"]}))},[o.phase,x]),s)return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(ee,{size:32})});const l=p||o.phase!=="idle"&&o.phase!=="complete"&&o.phase!=="error";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 g-animate-in",style:{color:"var(--g-text)"},children:[e.jsx(ie,{className:"w-5 h-5"}),"Dashboard"]}),l&&e.jsx("div",{className:"g-animate-scale",children:e.jsx(je,{progress:o})}),!l&&t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 g-animate-in g-stagger-1",children:[e.jsx(w,{label:"Download",value:t.download_mbps,color:"var(--g-blue)",threshold:r==null?void 0:r.download_threshold_mbps}),e.jsx(w,{label:"Upload",value:t.upload_mbps,color:"var(--g-green)",threshold:r==null?void 0:r.upload_threshold_mbps}),e.jsx(w,{label:"Ping",value:t.ping_latency_ms,unit:"ms",color:"var(--g-orange)"})]}),e.jsx("div",{className:"g-animate-in g-stagger-2",children:e.jsx(me,{measurement:t})}),n&&n.items.length>1&&e.jsxs("div",{className:"space-y-4 g-animate-in g-stagger-3",children:[e.jsx(xe,{measurements:n.items}),e.jsx(pe,{measurements:n.items})]})]}):l?null:e.jsxs("div",{className:"text-center py-20 g-animate-in",style:{color:"var(--g-text-secondary)"},children:[e.jsx("p",{className:"text-lg font-medium",children:"No measurements yet"}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Run Test" to perform your first speed test.'})]})]})}export{Ce as DashboardPage};
