import{j as e,a as y}from"./query-CSQiZfg4.js";import{G as o}from"./GlassCard-D-K6o67A.js";import{T as g,Z as u,A as i,I as p,C as j,m as f,$ as N,_ as b,j as _,S as x}from"./index-DhasJL8C.js";import{S as d}from"./server-BMFl4X2L.js";import{H as k}from"./house-D9hW6S7b.js";import{G as w,R as C}from"./router-CSimw0tn.js";import{W as S}from"./wifi-BV9JlfUn.js";import{C as P}from"./circle-check-big-BXX2FM31.js";import{C as D}from"./chevron-right-DzBUQa8w.js";import{T as L}from"./trending-down-CTcqstlz.js";import{T as h}from"./trending-up-CqyKiaTt.js";import{C as R}from"./calendar-VtcClLx8.js";import{R as I}from"./refresh-cw-CZ6vDWSF.js";import"./vendor-7Rr5RJ8N.js";function A(a){return a<-.6?"var(--g-red)":a<-.4?"var(--g-orange)":a<-.2?"var(--g-blue)":"var(--g-green)"}function B(a){return a>100?"var(--g-red)":a>50?"var(--g-orange)":a>20?"var(--g-blue)":"var(--g-green)"}function H({hops:a}){if(a.length===0)return e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:[e.jsx(d,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--g-text-secondary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:"No topology data available for correlation analysis."}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:"Run network topology scans to enable hop-speed correlation."})]});const t=a.filter(s=>s.is_bottleneck);return e.jsxs("div",{className:"space-y-4",children:[t.length>0&&e.jsxs("div",{className:"p-3 rounded-lg flex items-center gap-2",style:{background:"var(--g-orange-tint)"},children:[e.jsx(g,{className:"w-4 h-4 flex-shrink-0",style:{color:"var(--g-orange)"}}),e.jsxs("p",{className:"text-sm",style:{color:"var(--g-text)"},children:[e.jsx("strong",{children:t.length})," potential bottleneck",t.length>1?"s":""," detected at hop",t.length>1?"s":""," ",t.map(s=>s.hop_number).join(", ")]})]}),e.jsx("div",{className:"relative",children:a.map((s,r)=>{var n;const l=B(s.avg_latency_ms),c=A(s.latency_correlation);return e.jsxs("div",{className:"relative",children:[r<a.length-1&&e.jsx("div",{className:"absolute left-4 top-10 w-0.5 h-6",style:{background:"var(--g-card-bg)"}}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg mb-2",style:{background:s.is_bottleneck?"var(--g-red-tint)":"var(--g-card-bg)",boxShadow:s.is_bottleneck?"inset 0 0 0 2px var(--g-red)":void 0},children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{background:s.is_local?"var(--g-blue-tint)":s.is_bottleneck?"var(--g-red-tint)":"var(--g-card-bg)"},children:s.is_local?e.jsx(k,{className:"w-4 h-4",style:{color:"var(--g-blue)"}}):s.hop_number===((n=a[a.length-1])==null?void 0:n.hop_number)?e.jsx(d,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}):e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--g-text-secondary)"},children:s.hop_number})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium truncate",style:{color:"var(--g-text)"},children:s.hostname||s.ip_address||`Hop ${s.hop_number}`}),s.is_local&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:"var(--g-blue-tint)",color:"var(--g-blue)"},children:"Local"}),s.is_bottleneck&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:"var(--g-red)",color:"white"},children:"Bottleneck"})]}),s.ip_address&&s.hostname&&e.jsx("p",{className:"text-xs truncate",style:{color:"var(--g-text-secondary)"},children:s.ip_address})]}),e.jsxs("div",{className:"flex items-center gap-4 text-right",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Latency"}),e.jsxs("p",{className:"text-sm font-medium",style:{color:l},children:[s.avg_latency_ms.toFixed(1),"ms"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Correlation"}),e.jsx("p",{className:"text-sm font-medium",style:{color:c},children:s.latency_correlation.toFixed(2)})]}),s.packet_loss_pct>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Loss"}),e.jsxs("p",{className:"text-sm font-medium",style:{color:"var(--g-red)"},children:[s.packet_loss_pct.toFixed(1),"%"]})]})]})]})]},s.hop_number)})}),e.jsx("div",{className:"text-xs p-3 rounded-lg",style:{background:"var(--g-card-bg)"},children:e.jsxs("p",{style:{color:"var(--g-text-secondary)"},children:[e.jsx("strong",{children:"Correlation"}),": Relationship between hop latency and download speed. Negative values (red/orange) indicate higher latency at this hop correlates with slower speeds."]})})]})}const M=[{key:"dns_score",label:"DNS",icon:w},{key:"local_network_score",label:"Local Network",icon:C},{key:"isp_backbone_score",label:"ISP Backbone",icon:u},{key:"isp_lastmile_score",label:"ISP Last-Mile",icon:S},{key:"server_score",label:"Server",icon:d}];function T(a){return a>=80?"var(--g-green)":a>=60?"var(--g-blue)":a>=40?"var(--g-orange)":"var(--g-red)"}function F({scores:a}){return e.jsx("div",{className:"space-y-3",children:M.map(({key:t,label:s,icon:r})=>{const l=a[t],c=T(l);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-3.5 h-3.5",style:{color:"var(--g-text-secondary)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-text)"},children:s})]}),e.jsxs("span",{className:"text-xs font-medium",style:{color:c},children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"h-2 rounded-full overflow-hidden",style:{background:"var(--g-card-bg)"},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${l}%`,background:c}})})]},t)})})}function G(a){return a>=80?"var(--g-green)":a>=60?"var(--g-blue)":a>=40?"var(--g-orange)":"var(--g-red)"}function W(a){return a>=90?"Excellent":a>=80?"Good":a>=60?"Fair":a>=40?"Poor":"Critical"}function $({score:a,className:t=""}){const s=G(a),r=W(a),l=2*Math.PI*45,c=l-a/100*l;return e.jsxs("div",{className:`flex flex-col items-center ${t}`,children:[e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--g-card-bg)",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:s,strokeWidth:"8",strokeLinecap:"round",strokeDasharray:l,strokeDashoffset:c,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-3xl font-bold",style:{color:s},children:Math.round(a)}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"/ 100"})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1.5",children:[e.jsx(i,{className:"w-4 h-4",style:{color:s}}),e.jsx("span",{className:"text-sm font-medium",style:{color:s},children:r})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:"Network Health Score"})]})}const E={dns:"DNS",local_network:"Local Network",isp_backbone:"ISP Backbone",isp_lastmile:"ISP Last-Mile",server:"Server",time_based:"Time-Based",outages:"Outages",connection:"Connection"},z={critical:{icon:j,color:"var(--g-red)",bgColor:"var(--g-red-tint)",label:"Critical"},warning:{icon:g,color:"var(--g-orange)",bgColor:"var(--g-orange-tint)",label:"Warning"},info:{icon:p,color:"var(--g-blue)",bgColor:"var(--g-blue-tint)",label:"Info"}};function m({fingerprint:a,isPrimary:t=!1}){const s=z[a.severity],r=s.icon;return e.jsx("div",{className:"p-4 rounded-lg",style:{background:s.bgColor,boxShadow:t?`inset 0 0 0 2px ${s.color}`:void 0},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{background:`${s.color}20`},children:e.jsx(r,{className:"w-5 h-5",style:{color:s.color}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-medium",style:{background:s.color,color:"white"},children:"Primary Cause"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{background:"var(--g-card-bg)",color:"var(--g-text-secondary)"},children:E[a.category]||a.category}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{background:s.color+"30",color:s.color},children:s.label})]}),e.jsx("p",{className:"text-sm font-medium mt-2",style:{color:"var(--g-text)"},children:a.description}),e.jsxs("div",{className:"mt-2 flex items-center gap-3 text-xs",style:{color:"var(--g-text-secondary)"},children:[e.jsxs("span",{children:["Confidence: ",e.jsxs("strong",{style:{color:s.color},children:[Math.round(a.confidence*100),"%"]})]}),a.occurrence_count>1&&e.jsxs("span",{children:["Occurrences: ",e.jsx("strong",{children:a.occurrence_count})]})]}),a.evidence.length>0&&e.jsxs("div",{className:"mt-3 space-y-1",children:[e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--g-text-secondary)"},children:"Evidence:"}),e.jsx("ul",{className:"text-xs space-y-0.5",style:{color:"var(--g-text)"},children:a.evidence.map((l,c)=>e.jsxs("li",{className:"flex items-start gap-1.5",children:[e.jsx("span",{style:{color:s.color},children:"â€¢"}),l]},c))})]})]})]})})}const O={easy:{color:"var(--g-green)",bgColor:"var(--g-green-tint)",label:"Easy"},moderate:{color:"var(--g-orange)",bgColor:"var(--g-orange-tint)",label:"Moderate"},advanced:{color:"var(--g-red)",bgColor:"var(--g-red-tint)",label:"Advanced"}};function Z({recommendations:a}){return a.length===0?e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:[e.jsx(P,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--g-green)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:"No recommendations at this time."})]}):e.jsx("div",{className:"space-y-3",children:a.map((t,s)=>{const r=O[t.difficulty];return e.jsx("div",{className:"p-4 rounded-lg",style:{background:"var(--g-card-bg)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 text-sm font-bold",style:{background:s===0?"var(--g-blue)":"var(--g-card-bg)",color:s===0?"white":"var(--g-text-secondary)",border:s===0?"none":"1px solid var(--g-card-bg)"},children:t.priority}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--g-text)"},children:t.title}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{background:r.bgColor,color:r.color},children:r.label})]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--g-text-secondary)"},children:t.description}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(D,{className:"w-3 h-3",style:{color:"var(--g-green)"}}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-green)"},children:t.expected_impact})]})]})]})},s)})})}function U({pattern:a}){if(!a)return e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:[e.jsx(f,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--g-text-secondary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:"Not enough data to detect time-based patterns."}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:"More measurements during different times of day are needed."})]});const t=a.degradation_pct>0,s=t?L:h,r=t?"var(--g-orange)":"var(--g-green)";return e.jsxs("div",{className:"p-4 rounded-lg",style:{background:t?"var(--g-orange-tint)":"var(--g-green-tint)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(s,{className:"w-5 h-5",style:{color:r}}),e.jsx("h4",{className:"text-sm font-medium",style:{color:"var(--g-text)"},children:t?"Peak Hour Degradation":"Peak Hour Improvement"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Peak Hours (18:00-23:00)"}),e.jsxs("p",{className:"text-lg font-semibold",style:{color:t?"var(--g-orange)":"var(--g-text)"},children:[a.peak_avg_download_mbps.toFixed(1)," ",e.jsx("span",{className:"text-xs font-normal",children:"Mbps"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Off-Peak (02:00-08:00)"}),e.jsxs("p",{className:"text-lg font-semibold",style:{color:t?"var(--g-text)":"var(--g-green)"},children:[a.offpeak_avg_download_mbps.toFixed(1)," ",e.jsx("span",{className:"text-xs font-normal",children:"Mbps"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:"Difference:"}),e.jsxs("span",{className:"text-sm font-semibold",style:{color:r},children:[t?"-":"+",Math.abs(a.degradation_pct).toFixed(1),"%"]})]}),e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded",style:{background:"var(--g-card-bg)",color:"var(--g-text-secondary)"},children:["Confidence: ",Math.round(a.confidence*100),"%"]})]})]})}const V=[{value:7,label:"7 Days"},{value:14,label:"14 Days"},{value:30,label:"30 Days"},{value:60,label:"60 Days"},{value:90,label:"90 Days"}];function oe(){const[a,t]=y.useState(30),{data:s,isLoading:r,refetch:l,isFetching:c}=N({days:a});return e.jsxs("div",{className:"p-4 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-semibold flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(b,{className:"w-5 h-5",style:{color:"var(--g-text-secondary)"}}),"Root-Cause Analysis"]}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--g-text-secondary)"},children:"Identify and diagnose network performance issues"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}),e.jsx("select",{value:a,onChange:n=>t(Number(n.target.value)),className:"text-sm rounded-lg px-3 py-1.5 border-none outline-none",style:{background:"var(--g-card-bg)",color:"var(--g-text)"},children:V.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),e.jsxs(_,{variant:"default",onClick:()=>l(),disabled:c,children:[c?e.jsx(x,{size:16}):e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"ml-2 hidden sm:inline",children:"Refresh"})]})]})]}),r?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(x,{size:32})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(o,{className:"g-stagger-1 lg:col-span-1",children:e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx($,{score:s.network_health_score}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:["Based on ",s.measurement_count," measurements",s.topology_count>0&&` and ${s.topology_count} topology scans`]}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--g-text-secondary)"},children:["Analysis window: ",s.data_window_days," days"]})]})]})}),e.jsxs(o,{className:"g-stagger-2 lg:col-span-2",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-4 flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(h,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}),"Layer Health Breakdown"]}),e.jsx(F,{scores:s.layer_scores})]})]}),s.primary_cause&&e.jsxs(o,{className:"g-stagger-3",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-4 flex items-center gap-2",style:{color:"var(--g-text)"},children:[e.jsx(i,{className:"w-4 h-4",style:{color:"var(--g-text-secondary)"}}),"Primary Diagnosis"]}),e.jsx(m,{fingerprint:s.primary_cause,isPrimary:!0})]}),s.secondary_causes.length>0&&e.jsxs(o,{className:"g-stagger-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:["Additional Issues (",s.secondary_causes.length,")"]}),e.jsx("div",{className:"space-y-3",children:s.secondary_causes.map((n,v)=>e.jsx(m,{fingerprint:n},v))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{className:"g-stagger-5",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Time-Based Patterns"}),e.jsx(U,{pattern:s.time_pattern})]}),e.jsxs(o,{className:"g-stagger-6",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Connection Type Impact"}),s.connection_impact?e.jsxs("div",{className:"p-4 rounded-lg",style:{background:s.connection_impact.has_significant_difference?"var(--g-orange-tint)":"var(--g-green-tint)"},children:[e.jsx("p",{className:"text-sm",style:{color:"var(--g-text)"},children:s.connection_impact.recommendation}),s.connection_impact.has_significant_difference&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Best"}),e.jsx("p",{className:"text-sm font-medium capitalize",style:{color:"var(--g-green)"},children:s.connection_impact.best_connection})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:"Worst"}),e.jsx("p",{className:"text-sm font-medium capitalize",style:{color:"var(--g-orange)"},children:s.connection_impact.worst_connection})]})]})]}):e.jsx("div",{className:"p-4 rounded-lg text-center",style:{background:"var(--g-card-bg)"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--g-text-secondary)"},children:"Not enough data from different connection types."})})]})]}),s.hop_correlations.length>0&&e.jsxs(o,{className:"g-stagger-7",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Hop-Speed Correlation Analysis"}),e.jsx(H,{hops:s.hop_correlations})]}),e.jsxs(o,{className:"g-stagger-8",children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Recommendations"}),e.jsx(Z,{recommendations:s.recommendations})]})]}):e.jsx(o,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(i,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--g-text-secondary)"}}),e.jsx("h2",{className:"text-lg font-medium",style:{color:"var(--g-text)"},children:"No Analysis Available"}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--g-text-secondary)"},children:"Not enough data to perform root-cause analysis. Run more speed tests to gather data."})]})})]})}export{oe as RootCausePage};
