import{j as e,a as g}from"./query-CSQiZfg4.js";import{c as X,u as xe,A as L,T as me,G as ue,C as q,a as he,Z as Q,b as pe,d as ge,e as fe,f as ve,g as je,h as ye,S as be,i as we}from"./index-C_tFdaUs.js";import{G as A}from"./GlassCard-D-K6o67A.js";import{A as Ne,u as Z,P as E}from"./ProgressRing-E9DLy4Yg.js";import{f as J,a as ee}from"./format-Bm42Q-0N.js";import{R as te,L as se,C as ae,X as re,Y as ne,T as ie,a as ke,b as H,c as W}from"./charts-ZBqAZ0pw.js";import{L as Me}from"./vendor-7Rr5RJ8N.js";import{C as _e}from"./chevron-right-gGUReA-1.js";import{H as $e}from"./house-DHtggr3I.js";import{R as Ce,U as Se,B as Re,G as Le,a as Ae,V as Fe,T as Pe}from"./video-Coj0cc7j.js";import{A as oe,a as B}from"./arrow-up-CJBc_Ry-.js";import{W as De}from"./wifi-DvuVlqdF.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],Ge=X("monitor-play",We);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17",key:"1q2vi4"}],["path",{d:"m10 15 5-3-5-3z",key:"1jp15x"}]],ze=X("youtube",Ie);function I({label:t,sublabel:s,value:a,unit:r="Mbps",color:i,threshold:n,thresholdLabel:l}){const u=n!==void 0,d=u&&a<n,p=u&&a>=n;return e.jsxs(A,{hover:!0,className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--g-text-secondary)"},children:t}),s&&e.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded",style:{background:"var(--g-surface)",color:"var(--g-text-secondary)"},children:s})]}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx(Ne,{value:a,decimals:1,className:"text-5xl font-bold tracking-tight",style:{color:d?"var(--g-red)":p?"var(--g-green)":i}}),e.jsx("span",{className:"text-lg font-medium",style:{color:"var(--g-text-secondary)"},children:r})]}),u&&e.jsxs("p",{className:"text-xs mt-2 font-medium",style:{color:d?"var(--g-red)":"var(--g-green)"},children:[d?"Below threshold":"Above threshold"," (",l||`${n} ${r}`,")"]})]})}function Te(t,s){if(s)return"VPN";const a=t.toLowerCase();return a.startsWith("eth")||a.startsWith("en")||a.startsWith("docker")||a.startsWith("br")?"Ethernet":a.startsWith("wl")||a.startsWith("wi")||a.includes("wifi")||a.includes("wlan")?"WiFi":a.startsWith("tun")||a.startsWith("tap")||a.startsWith("wg")?"VPN":!a||a==="unknown"?"Unknown":t}function Be({measurement:t}){return e.jsxs(A,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--g-text)"},children:"Latest Test"}),e.jsx("span",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:J(t.timestamp)})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Server"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.server_name})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Location"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.server_location})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"ISP"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.isp})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Jitter"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.ping_jitter_ms!==null&&t.ping_jitter_ms!==void 0?`${t.ping_jitter_ms.toFixed(1)} ms`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Packet Loss"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:t.packet_loss_pct!==null&&t.packet_loss_pct!==void 0?`${t.packet_loss_pct.toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{style:{color:"var(--g-text-secondary)"},children:"Connection"}),e.jsx("p",{className:"font-medium",style:{color:"var(--g-text)"},children:Te(t.interface_name,t.is_vpn)})]})]})]})}const Oe=g.memo(function({measurements:s,downloadThreshold:a,uploadThreshold:r}){const i=g.useMemo(()=>[...s].reverse().map(n=>({time:ee(n.timestamp),download:Number(n.download_mbps.toFixed(1)),upload:Number(n.upload_mbps.toFixed(1))})),[s]);return e.jsxs(A,{children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Speed Over Time"}),e.jsx(te,{width:"100%",height:300,children:e.jsxs(se,{data:i,children:[e.jsx(ae,{strokeDasharray:"3 3",stroke:"var(--g-border)"}),e.jsx(re,{dataKey:"time",tick:{fontSize:11},stroke:"var(--g-text-tertiary)"}),e.jsx(ne,{tick:{fontSize:11},stroke:"var(--g-text-tertiary)",unit:" Mbps"}),e.jsx(ie,{contentStyle:{background:"var(--g-card-bg)",border:"1px solid var(--g-card-border)",borderRadius:"var(--g-radius-sm)",backdropFilter:"blur(20px)",fontSize:"var(--g-text-xs)"}}),e.jsx(ke,{}),a&&e.jsx(H,{y:a,stroke:"var(--g-blue)",strokeDasharray:"5 5",strokeOpacity:.7,label:{value:`Min ${a} Mbps`,position:"right",fill:"var(--g-blue)",fontSize:10}}),r&&e.jsx(H,{y:r,stroke:"var(--g-green)",strokeDasharray:"5 5",strokeOpacity:.7,label:{value:`Min ${r} Mbps`,position:"right",fill:"var(--g-green)",fontSize:10}}),e.jsx(W,{type:"monotone",dataKey:"download",stroke:"var(--g-blue)",strokeWidth:2,dot:!1,name:"Download",animationDuration:800,animationBegin:0,animationEasing:"ease-out"}),e.jsx(W,{type:"monotone",dataKey:"upload",stroke:"var(--g-green)",strokeWidth:2,dot:!1,name:"Upload",animationDuration:800,animationBegin:200,animationEasing:"ease-out"})]})})]})});function Ee({measurements:t}){const s=[...t].reverse().map(a=>({time:ee(a.timestamp),ping:Number(a.ping_latency_ms.toFixed(1)),jitter:Number(a.ping_jitter_ms.toFixed(1))}));return e.jsxs(A,{children:[e.jsx("h3",{className:"text-sm font-semibold mb-4",style:{color:"var(--g-text)"},children:"Latency Over Time"}),e.jsx(te,{width:"100%",height:250,children:e.jsxs(se,{data:s,children:[e.jsx(ae,{strokeDasharray:"3 3",stroke:"var(--g-border)"}),e.jsx(re,{dataKey:"time",tick:{fontSize:11},stroke:"var(--g-text-tertiary)"}),e.jsx(ne,{tick:{fontSize:11},stroke:"var(--g-text-tertiary)",unit:" ms"}),e.jsx(ie,{contentStyle:{background:"var(--g-card-bg)",border:"1px solid var(--g-card-border)",borderRadius:"var(--g-radius-sm)",backdropFilter:"blur(20px)",fontSize:"var(--g-text-xs)"}}),e.jsx(W,{type:"monotone",dataKey:"ping",stroke:"var(--g-orange)",strokeWidth:2,dot:!1,name:"Ping",animationDuration:800,animationBegin:0,animationEasing:"ease-out"}),e.jsx(W,{type:"monotone",dataKey:"jitter",stroke:"var(--g-purple)",strokeWidth:2,dot:!1,name:"Jitter",animationDuration:800,animationBegin:200,animationEasing:"ease-out"})]})})]})}const He={netflix_4k:Pe,youtube_4k:ze,zoom_hd:Fe,teams_call:Ae,cloud_gaming:Ge,online_gaming:Le,vpn_work:Re,video_upload:Se,live_streaming:Ce,smart_home:$e};function Ue(){const{data:t,isLoading:s}=xe();if(s||!t)return null;const a=t.passed_profiles,r=t.total_profiles,i=Math.round(a/r*100);return e.jsxs("div",{className:"glass-card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4",style:{color:"var(--g-accent)"}}),e.jsx("h3",{className:"font-semibold text-sm",style:{color:"var(--g-text)"},children:"Application Compatibility"})]}),e.jsxs(Me,{to:"/qos",className:"flex items-center gap-1 text-xs hover:underline",style:{color:"var(--g-accent)"},children:["View all",e.jsx(_e,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",style:{color:"var(--g-text-secondary)"},children:[e.jsxs("span",{children:[a," of ",r," optimal"]}),e.jsxs("span",{children:[i,"%"]})]}),e.jsx("div",{className:"h-1.5 rounded-full",style:{backgroundColor:"var(--g-surface)"},children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${i}%`,backgroundColor:i>=80?"var(--g-green)":i>=50?"var(--g-amber)":"var(--g-red)"}})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.results.slice(0,6).map(n=>{const l=He[n.profile_id]||L;return e.jsx("div",{title:`${n.profile_name}: ${n.passed?"Optimal":"Limited"}`,className:"w-8 h-8 rounded-lg flex items-center justify-center",style:{backgroundColor:n.passed?"rgba(34, 197, 94, 0.15)":"rgba(239, 68, 68, 0.15)"},children:e.jsx(l,{className:"w-4 h-4",style:{color:n.passed?"var(--g-green)":"var(--g-red)"}})},n.profile_id)}),t.results.length>6&&e.jsxs("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-medium",style:{backgroundColor:"var(--g-surface)",color:"var(--g-text-secondary)"},children:["+",t.results.length-6]})]})]})}function Ve(t){return t>=80?"var(--g-green)":t>=60?"var(--g-blue)":t>=40?"var(--g-orange)":"var(--g-red)"}function Ye(t){switch(t){case"A+":case"A":return"Excellent";case"B":return"Good";case"C":return"Fair";case"D":return"Poor";default:return"Critical"}}function Ke(t){return t>=85?"Great for 4K streaming, gaming, and video calls":t>=70?"Suitable for HD streaming and most online activities":t>=50?"May experience issues with HD streaming or gaming":t>=30?"Limited to basic browsing and SD streaming":"Significant connectivity issues detected"}function D({label:t,value:s,color:a}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px]",style:{color:"var(--g-text-secondary)"},children:t}),e.jsx("span",{className:"text-[10px] font-medium tabular-nums",style:{color:"var(--g-text)"},children:s.toFixed(0)})]}),e.jsx("div",{className:"h-1.5 rounded-full",style:{background:"var(--g-border)"},children:e.jsx("div",{className:"h-full rounded-full transition-all duration-700",style:{width:`${Math.min(s,100)}%`,background:a}})})]})}function Xe({score:t}){if(!t)return null;const s=Ve(t.composite),a=Ye(t.grade),r=Ke(t.composite),i=80,n=6,l=(i-n)/2,u=2*Math.PI*l,d=t.composite/100*u;return e.jsx(A,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"shrink-0 relative",style:{width:i,height:i},children:[e.jsxs("svg",{width:i,height:i,className:"-rotate-90",children:[e.jsx("circle",{cx:i/2,cy:i/2,r:l,fill:"none",stroke:"var(--g-border)",strokeWidth:n}),e.jsx("circle",{cx:i/2,cy:i/2,r:l,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeDasharray:u,strokeDashoffset:u-d,className:"transition-all duration-1000"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-bold",style:{color:s},children:t.grade}),e.jsx("span",{className:"text-[9px]",style:{color:"var(--g-text-tertiary)"},children:t.composite.toFixed(0)})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--g-text)"},children:"Connection Health"}),e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full",style:{color:s,background:`${s}15`},children:a})]}),e.jsx("p",{className:"text-xs mb-3",style:{color:"var(--g-text-secondary)"},children:r}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5",children:[e.jsx(D,{label:"Speed",value:t.breakdown.speed_score,color:"var(--g-blue)"}),e.jsx(D,{label:"Reliability",value:t.breakdown.reliability_score,color:"var(--g-green)"}),e.jsx(D,{label:"Latency",value:t.breakdown.latency_score,color:"var(--g-orange)"}),e.jsx(D,{label:"Consistency",value:t.breakdown.consistency_score,color:"var(--g-teal)"})]})]})]})})}function qe({outage:t}){return t.outage_active?e.jsxs("div",{role:"alert",className:"flex items-center gap-3 p-3 rounded-xl g-animate-in",style:{background:"var(--g-red)12",border:"1px solid var(--g-red)30"},children:[e.jsx(me,{className:"w-5 h-5 shrink-0",style:{color:"var(--g-red)"}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--g-red)"},children:"Outage Detected"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--g-text-secondary)"},children:[t.consecutive_failures," consecutive failure",t.consecutive_failures!==1?"s":"",t.outage_started_at&&` since ${J(t.outage_started_at)}`]})]})]}):null}function Qe(){const t=g.useRef([]),s=g.useRef(0),[a,r]=g.useState(0),i=g.useRef(0),n=g.useCallback((d,p)=>{t.current.push({time:p,value:d}),d>s.current&&(s.current=d);const m=performance.now();m-i.current>250&&(i.current=m,r(c=>c+1))},[]),l=g.useCallback(()=>{t.current=[],s.current=0,i.current=0,r(0)},[]),u=g.useCallback(()=>{r(d=>d+1)},[]);return{samples:t.current,peak:s.current,push:n,reset:l,flush:u,version:a}}function U({value:t,max:s=1e3,label:a="Speed",color:r="var(--g-blue)",unit:i="Mbps",glowColor:n}){const l=g.useId(),u=`needleGlow${l}`,d=`arcGlow${l}`,p=`tipPulse${l}`,m=`arcGradient${l}`,c=Z(t,400),w=Math.min(c,s),C=-135+w/s*270,o=80,f=100,x=100,h=n||r,b=[0,.25,.5,.75,1].map(y=>{const _=(-135+y*270)*(Math.PI/180);return{x1:f+(o-10)*Math.cos(_),y1:x+(o-10)*Math.sin(_),x2:f+o*Math.cos(_),y2:x+o*Math.sin(_),label:Math.round(y*s),lx:f+(o-18)*Math.cos(_),ly:x+(o-18)*Math.sin(_)}}),N=Array.from({length:21},(y,_)=>{const O=_/20,P=(-135+O*270)*(Math.PI/180);return{x1:f+(o-4)*Math.cos(P),y1:x+(o-4)*Math.sin(P),x2:f+o*Math.cos(P),y2:x+o*Math.sin(P),active:O<=w/s}}),j=-135*(Math.PI/180),v=C*(Math.PI/180),k=f+o*Math.cos(j),S=x+o*Math.sin(j),G=f+o*Math.cos(v),F=x+o*Math.sin(v),$=C- -135>180?1:0,R=C*(Math.PI/180),M=f+(o-18)*Math.cos(R),le=x+(o-18)*Math.sin(R),ce=f+(o-20)*Math.cos(R),de=x+(o-20)*Math.sin(R);return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{viewBox:"0 0 200 145",className:"w-full max-w-[260px]",children:[e.jsxs("defs",{children:[e.jsxs("filter",{id:u,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"3",result:"blur"}),e.jsx("feFlood",{floodColor:h,floodOpacity:"0.6",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"glow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("filter",{id:d,x:"-20%",y:"-20%",width:"140%",height:"140%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"blur"}),e.jsx("feFlood",{floodColor:h,floodOpacity:"0.4",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"glow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsx("filter",{id:p,x:"-100%",y:"-100%",width:"300%",height:"300%",children:e.jsx("feGaussianBlur",{stdDeviation:"4"})}),e.jsxs("linearGradient",{id:m,x1:"0",y1:"0",x2:"1",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:r,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:r,stopOpacity:"1"})]})]}),e.jsx("path",{d:`M ${f+o*Math.cos(j)} ${x+o*Math.sin(j)} A ${o} ${o} 0 1 1 ${f+o*Math.cos(135*Math.PI/180)} ${x+o*Math.sin(135*Math.PI/180)}`,fill:"none",stroke:"var(--g-border)",strokeWidth:"6",strokeLinecap:"round",opacity:"0.5"}),c>0&&e.jsx("path",{d:`M ${f+o*Math.cos(j)} ${x+o*Math.sin(j)} A ${o} ${o} 0 1 1 ${f+o*Math.cos(135*Math.PI/180)} ${x+o*Math.sin(135*Math.PI/180)}`,fill:"none",stroke:r,strokeWidth:"8",strokeLinecap:"round",filter:`url(#${d})`,children:e.jsx("animate",{attributeName:"opacity",values:"0.05;0.15;0.05",dur:"3s",repeatCount:"indefinite"})}),N.map((y,_)=>e.jsx("line",{x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,stroke:y.active?r:"var(--g-border)",strokeWidth:"1",strokeLinecap:"round",opacity:y.active?.8:.3},`minor-${_}`)),c>0&&e.jsx("path",{d:`M ${k} ${S} A ${o} ${o} 0 ${$} 1 ${G} ${F}`,fill:"none",stroke:`url(#${m})`,strokeWidth:"6",strokeLinecap:"round",filter:`url(#${d})`}),b.map((y,_)=>e.jsxs("g",{children:[e.jsx("line",{x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,stroke:"var(--g-text-tertiary)",strokeWidth:"1.5",strokeLinecap:"round"}),e.jsx("text",{x:y.lx,y:y.ly,textAnchor:"middle",dominantBaseline:"middle",fill:"var(--g-text-secondary)",fontSize:"7",fontWeight:"500",children:y.label})]},`major-${_}`)),e.jsx("line",{x1:f,y1:x,x2:M,y2:le,stroke:r,strokeWidth:"2",strokeLinecap:"round",filter:`url(#${u})`}),e.jsx("circle",{cx:f,cy:x,r:"5",fill:r,opacity:"0.9"}),e.jsx("circle",{cx:f,cy:x,r:"3",fill:"var(--g-bg)"}),c>0&&e.jsxs("circle",{cx:ce,cy:de,r:"6",fill:r,filter:`url(#${p})`,opacity:"0.5",children:[e.jsx("animate",{attributeName:"opacity",values:"0.3;0.7;0.3",dur:"1.5s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"r",values:"4;8;4",dur:"1.5s",repeatCount:"indefinite"})]})]}),e.jsxs("div",{className:"text-center -mt-2",children:[e.jsx("span",{className:"text-4xl font-bold tabular-nums g-number-glow-pulse",style:{color:r,"--glow-color":`${h}60`,textShadow:`0 0 20px ${h}40, 0 0 40px ${h}20`},children:c.toFixed(1)}),e.jsx("span",{className:"text-sm ml-1",style:{color:"var(--g-text-secondary)"},children:i})]}),e.jsx("span",{className:"text-xs mt-1 font-medium uppercase tracking-wider",style:{color:"var(--g-text-tertiary)"},children:a})]})}function V(t){return t.includes("--g-blue")||t==="#007AFF"?[0,122,255]:t.includes("--g-green")||t==="#34C759"?[52,199,89]:t.includes("--g-teal")?[0,199,190]:t.includes("--g-orange")?[255,149,0]:t.startsWith("#")&&t.length===7?[parseInt(t.slice(1,3),16),parseInt(t.slice(3,5),16),parseInt(t.slice(5,7),16)]:[0,122,255]}function Y({direction:t,bandwidth:s,color:a}){const r=g.useRef(null),i=g.useRef([]),n=g.useRef(0),l=g.useRef({w:0,h:0}),u=g.useRef({direction:t,bandwidth:s,color:a});u.current={direction:t,bandwidth:s,color:a};const d=typeof window<"u"&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,p=g.useCallback((m,c,w)=>{const C=u.current.bandwidth,o=Math.min(1,Math.max(.1,C/500));return{x:Math.random()*m,y:w?Math.random()*c:u.current.direction==="download"?-10:c+10,speed:(1+Math.random()*2)*(.5+o*2),radius:1+Math.random()*2.5,opacity:.3+Math.random()*.5}},[]);return g.useEffect(()=>{const m=r.current;if(!m)return;const c=m.getContext("2d");if(!c)return;if(d){const x=()=>{const b=m.getBoundingClientRect(),N=window.devicePixelRatio||1;m.width=b.width*N,m.height=b.height*N,c.scale(N,N);const[j,v,k]=V(u.current.color),S=c.createLinearGradient(0,0,0,b.height);S.addColorStop(0,`rgba(${j},${v},${k},0.03)`),S.addColorStop(.5,`rgba(${j},${v},${k},0.08)`),S.addColorStop(1,`rgba(${j},${v},${k},0.03)`),c.fillStyle=S,c.fillRect(0,0,b.width,b.height)};x();const h=new ResizeObserver(x);return h.observe(m),()=>h.disconnect()}const w=new ResizeObserver(x=>{for(const h of x){const{width:b,height:N}=h.contentRect,j=window.devicePixelRatio||1;m.width=b*j,m.height=N*j,l.current={w:b,h:N}}});w.observe(m);const C=m.clientWidth||400,o=m.clientHeight||300;l.current={w:C,h:o},i.current=Array.from({length:80},()=>p(C,o,!0));function f(){const{w:x,h}=l.current;if(x===0||h===0){n.current=requestAnimationFrame(f);return}const b=window.devicePixelRatio||1;c.clearRect(0,0,x*b,h*b),c.save(),c.scale(b,b);const{direction:N,bandwidth:j,color:v}=u.current,[k,S,G]=V(v),F=Math.min(120,Math.max(60,Math.floor(40+j/5))),$=i.current;for(;$.length<F;)$.push(p(x,h,!1));$.length>F+10&&$.splice(F,$.length-F),c.globalCompositeOperation="lighter",c.fillStyle=`rgb(${k},${S},${G})`;for(let R=$.length-1;R>=0;R--){const M=$[R];if(N==="download"){if(M.y+=M.speed,M.y>h+10){$[R]=p(x,h,!1);continue}}else if(M.y-=M.speed,M.y<-10){$[R]=p(x,h,!1);continue}c.globalAlpha=M.opacity,c.beginPath(),c.arc(M.x,M.y,M.radius*2,0,Math.PI*2),c.fill()}c.globalAlpha=1,c.restore(),n.current=requestAnimationFrame(f)}return n.current=requestAnimationFrame(f),()=>{cancelAnimationFrame(n.current),w.disconnect()}},[d,p]),e.jsx("canvas",{ref:r,className:"absolute inset-0 w-full h-full pointer-events-none",style:{opacity:.6}})}function K({samples:t,peak:s,color:a}){const r=g.useId(),i=`speed-graph-glow${r}`,n=`graph-fill-grad${r}`;if(t.length<2)return null;const l=320,u=80,d=4,p=4,m=4,c=l-d*2,w=u-p-m,C=Math.max(s*1.1,10),o=t[0].time,f=t[t.length-1].time,x=Math.max(f-o,1),h=t.map(v=>{const k=d+(v.time-o)/x*c,S=p+w-v.value/C*w;return{x:k,y:S}}),b=h.map(v=>`${v.x},${v.y}`).join(" "),N=`M ${h[0].x},${p+w} `+h.map(v=>`L ${v.x},${v.y}`).join(" ")+` L ${h[h.length-1].x},${p+w} Z`,j=h[h.length-1];return e.jsx("div",{className:"w-full max-w-xs mx-auto",children:e.jsxs("svg",{viewBox:`0 0 ${l} ${u}`,className:"w-full",style:{height:80},preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsxs("filter",{id:i,x:"-20%",y:"-20%",width:"140%",height:"140%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),e.jsx("feFlood",{floodColor:a,floodOpacity:"0.5",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"glow"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]}),e.jsxs("linearGradient",{id:n,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:a,stopOpacity:"0.3"}),e.jsx("stop",{offset:"100%",stopColor:a,stopOpacity:"0.02"})]})]}),[.25,.5,.75].map(v=>{const k=p+w-v*w;return e.jsx("line",{x1:d,y1:k,x2:l-d,y2:k,stroke:"var(--g-border)",strokeWidth:"0.5",opacity:"0.3"},v)}),e.jsx("path",{d:N,fill:`url(#${n})`}),e.jsx("polyline",{points:b,fill:"none",stroke:a,strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round",filter:`url(#${i})`}),e.jsxs("circle",{cx:j.x,cy:j.y,r:"4",fill:a,opacity:"0.9",children:[e.jsx("animate",{attributeName:"r",values:"3;5;3",dur:"1.5s",repeatCount:"indefinite"}),e.jsx("animate",{attributeName:"opacity",values:"0.9;0.5;0.9",dur:"1.5s",repeatCount:"indefinite"})]})]})})}function Ze({elapsed:t,color:s="var(--g-text-secondary)"}){const a=Math.floor(t),r=Math.floor(a/60),i=a%60,n=`${r}:${String(i).padStart(2,"0")}`;return e.jsx("span",{className:"text-sm tabular-nums",style:{color:s,fontVariantNumeric:"tabular-nums"},children:n})}const Je={idle:"Ready",started:"Initializing",ping:"Measuring Latency",download:"Download",upload:"Upload",complete:"Complete",error:"Failed"},et={idle:"var(--g-text-secondary)",started:"var(--g-teal)",ping:"var(--g-orange)",download:"var(--g-blue)",upload:"var(--g-green)",complete:"var(--g-blue)",error:"var(--g-red)"},tt={download:"#007AFF",upload:"#34C759"},st={idle:De,started:Q,ping:L,download:B,upload:oe,complete:he,error:q};function z({label:t,value:s,unit:a,color:r,icon:i,delay:n}){const l=Z(s,900);return e.jsx("div",{className:"g-animate-in",style:{animationDelay:`${n}ms`},children:e.jsxs(A,{padding:"md",depth:"elevated",className:"text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0",style:{height:3,background:`linear-gradient(90deg, transparent, ${r}, transparent)`}}),e.jsx(i,{className:"w-4 h-4 mx-auto mb-2",style:{color:r,opacity:.7}}),e.jsx("span",{className:"text-3xl font-bold tabular-nums block g-number-glow-pulse",style:{color:r,"--glow-color":`${r}40`},children:l.toFixed(1)}),e.jsx("span",{className:"text-[11px] block mt-0.5",style:{color:"var(--g-text-secondary)"},children:a}),e.jsx("span",{className:"text-[10px] font-semibold block mt-1.5 uppercase tracking-widest",style:{color:"var(--g-text-tertiary)"},children:t})]})})}function T({icon:t,value:s,unit:a,color:r}){return e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs tabular-nums",style:{color:"var(--g-text-secondary)"},children:[e.jsx(t,{className:"w-3 h-3",style:{color:r,opacity:.8}}),e.jsx("span",{style:{color:r},children:s}),e.jsx("span",{className:"text-[10px]",children:a})]})}function at({progress:t}){const s=t.phase,a=et[s]||"var(--g-blue)",r=st[s]||L,i=s!=="idle"&&s!=="complete"&&s!=="error",n=s==="download"||s==="upload",l=Qe(),u=g.useRef(s),[d,p]=g.useState(null),[m,c]=g.useState(null);return g.useEffect(()=>{s==="ping"&&t.ping_ms&&p(t.ping_ms),s==="download"&&t.bandwidth_mbps&&c(t.bandwidth_mbps),s==="idle"&&(p(null),c(null))},[s,t.ping_ms,t.bandwidth_mbps]),g.useEffect(()=>{u.current!==s&&((s==="download"||s==="upload")&&l.reset(),u.current=s),n&&t.bandwidth_mbps!==void 0&&t.elapsed!==void 0&&l.push(t.bandwidth_mbps,t.elapsed)},[s,t.bandwidth_mbps,t.elapsed,n,l]),e.jsxs(A,{padding:"none",depth:"elevated",className:"relative overflow-hidden",children:[n&&e.jsx(Y,{direction:s,bandwidth:t.bandwidth_mbps||0,color:tt[s]||a}),s==="started"&&e.jsx(Y,{direction:"download",bandwidth:5,color:"var(--g-teal)"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-5 py-8 px-6",children:[e.jsxs("div",{className:"flex items-center justify-between w-full max-w-md",children:[e.jsxs(ue,{color:a,children:[i&&e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{background:a,boxShadow:`0 0 8px ${a}`,animation:"g-breathe 1.5s ease-in-out infinite"}}),e.jsx(r,{className:"w-3.5 h-3.5"}),Je[s]||s]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s==="download"&&d!==null&&e.jsx(T,{icon:L,value:d.toFixed(0),unit:"ms",color:"var(--g-orange)"}),s==="upload"&&e.jsxs(e.Fragment,{children:[d!==null&&e.jsx(T,{icon:L,value:d.toFixed(0),unit:"ms",color:"var(--g-orange)"}),m!==null&&e.jsx(T,{icon:B,value:m.toFixed(0),unit:"Mbps",color:"var(--g-blue)"})]}),i&&t.elapsed!==void 0&&e.jsx(Ze,{elapsed:t.elapsed,color:a})]})]},s),e.jsxs("div",{className:"w-full flex flex-col items-center gap-4 g-phase-enter",children:[s==="started"&&e.jsxs("div",{className:"flex flex-col items-center gap-5 py-4",children:[e.jsx(E,{value:30,max:100,size:130,strokeWidth:5,color:"var(--g-teal)",glow:!0,children:e.jsx(Q,{className:"w-9 h-9",style:{color:"var(--g-teal)",animation:"g-breathe 2s ease-in-out infinite"}})}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--g-text-secondary)"},children:"Connecting to server..."})]}),s==="ping"&&e.jsx("div",{className:"flex flex-col items-center gap-4 py-2",children:e.jsx(E,{value:(t.progress||0)*100,max:100,size:160,strokeWidth:6,color:"var(--g-orange)",glow:!0,children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-4xl font-bold tabular-nums g-number-glow-pulse",style:{color:"var(--g-orange)","--glow-color":"rgba(255, 149, 0, 0.4)"},children:(t.ping_ms||0).toFixed(1)}),e.jsx("span",{className:"text-xs block mt-0.5",style:{color:"var(--g-text-secondary)"},children:"ms"})]})})}),s==="download"&&e.jsxs("div",{className:"w-full flex flex-col items-center gap-3",children:[e.jsx(U,{value:t.bandwidth_mbps||0,label:"Download",color:"var(--g-blue)",glowColor:"#007AFF"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx("div",{className:"border-t pt-2",style:{borderColor:"var(--g-border)"},children:e.jsx(K,{samples:l.samples,peak:l.peak,color:"var(--g-blue)",version:l.version})})})]}),s==="upload"&&e.jsxs("div",{className:"w-full flex flex-col items-center gap-3",children:[e.jsx(U,{value:t.bandwidth_mbps||0,label:"Upload",color:"var(--g-green)",glowColor:"#34C759"}),e.jsx("div",{className:"w-full max-w-xs",children:e.jsx("div",{className:"border-t pt-2",style:{borderColor:"var(--g-border)"},children:e.jsx(K,{samples:l.samples,peak:l.peak,color:"var(--g-green)",version:l.version})})})]}),s==="complete"&&e.jsx("div",{className:"w-full max-w-md py-2",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(z,{label:"Download",value:t.download_mbps||0,unit:"Mbps",color:"var(--g-blue)",icon:B,delay:0}),e.jsx(z,{label:"Upload",value:t.upload_mbps||0,unit:"Mbps",color:"var(--g-green)",icon:oe,delay:120}),e.jsx(z,{label:"Ping",value:t.ping_ms||0,unit:"ms",color:"var(--g-orange)",icon:L,delay:240})]})}),s==="error"&&e.jsxs("div",{className:"text-center g-animate-in py-4",children:[e.jsx(q,{className:"w-8 h-8 mx-auto mb-3",style:{color:"var(--g-red)",opacity:.8}}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--g-red)"},children:t.message||"An error occurred"})]})]},`content-${s}`),n&&t.progress!==void 0&&e.jsxs("div",{className:"w-full max-w-xs",children:[e.jsx("div",{className:"glass-progress",style:{height:5},children:e.jsx("div",{className:"glass-progress-bar",style:{width:`${Math.min(100,(t.progress||0)*100)}%`,background:`linear-gradient(90deg, ${a}90, ${a})`,boxShadow:`0 0 12px ${a}50`,transition:"width 0.3s ease-out"}})}),e.jsxs("p",{className:"text-[10px] text-center mt-1.5 tabular-nums font-medium",style:{color:"var(--g-text-tertiary)"},children:[Math.round((t.progress||0)*100),"%"]})]})]})]})}function gt(){const{data:t,isLoading:s}=pe(),{data:a}=ge({page_size:50}),{data:r}=fe(),{data:i}=ve(),{data:n}=je(),{progress:l,isStreaming:u,testActive:d,_debug:p}=ye();if(s)return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(be,{size:32})});const m=d||u||l.phase!=="idle"&&l.phase!=="complete"&&l.phase!=="error";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 g-animate-in",style:{color:"var(--g-text)"},children:[e.jsx(we,{className:"w-5 h-5"}),"Dashboard"]}),(n==null?void 0:n.outage)&&e.jsx(qe,{outage:n.outage}),m&&e.jsx("div",{className:"g-animate-scale",children:e.jsx(at,{progress:l})}),p&&e.jsx("div",{className:"text-xs font-mono px-3 py-1.5 rounded-lg",style:{background:"rgba(0,0,0,0.6)",color:"#0f0",backdropFilter:"blur(4px)",wordBreak:"break-all"},children:p}),!m&&t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 g-animate-in g-stagger-1",children:[e.jsx(I,{label:"Download",sublabel:"Latest Test",value:t.download_mbps,color:"var(--g-blue)",threshold:r==null?void 0:r.effective_download_threshold_mbps,thresholdLabel:r?`Min. ${r.effective_download_threshold_mbps} Mbps`:void 0}),e.jsx(I,{label:"Upload",sublabel:"Latest Test",value:t.upload_mbps,color:"var(--g-green)",threshold:r==null?void 0:r.effective_upload_threshold_mbps,thresholdLabel:r?`Min. ${r.effective_upload_threshold_mbps} Mbps`:void 0}),e.jsx(I,{label:"Ping",sublabel:"Latest Test",value:t.ping_latency_ms,unit:"ms",color:"var(--g-orange)"})]}),(i==null?void 0:i.isp_score)&&e.jsx("div",{className:"g-animate-in g-stagger-2",children:e.jsx(Xe,{score:i.isp_score})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 g-animate-in g-stagger-3",children:[e.jsx(Be,{measurement:t}),e.jsx(Ue,{})]}),a&&a.items.length>1&&e.jsxs("div",{className:"space-y-4 g-animate-in g-stagger-4",children:[e.jsx(Oe,{measurements:a.items,downloadThreshold:r==null?void 0:r.effective_download_threshold_mbps,uploadThreshold:r==null?void 0:r.effective_upload_threshold_mbps}),e.jsx(Ee,{measurements:a.items})]})]}):m?null:e.jsxs("div",{className:"text-center py-20 g-animate-in",style:{color:"var(--g-text-secondary)"},children:[e.jsx("p",{className:"text-lg font-medium",children:"No measurements yet"}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Run Test" to perform your first speed test.'})]})]})}export{gt as DashboardPage};
